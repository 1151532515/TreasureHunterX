{"version":3,"sources":["../../../../assets/scripts/assets/scripts/Map.js"],"names":["i18n","require","init","window","language","ALL_MAP_STATES","VISUAL","EDITING_BELONGING","SHOWING_MODAL_POPUP","cc","Class","extends","Component","properties","selfPlayer","canvasNode","type","Node","default","tiledAnimPrefab","Prefab","selfPlayerPrefab","npcPlayerPrefab","type2NpcPlayerPrefab","barrierPrefab","shelterPrefab","shelterZReducerPrefab","keyboardInputControllerNode","joystickInputControllerNode","confirmLogoutPrefab","simplePressToGoDialogPrefab","boundRoomIdLabel","Label","countdownLabel","_onPerUpsyncFrame","instance","selfPlayerId","selfPlayerScriptIns","scheduledDirection","upsyncFrameData","id","dir","dx","parseFloat","dy","x","y","wrapped","msgId","Date","now","act","data","clientSession","send","JSON","stringify","onDestroy","self","upsyncLoopInterval","clearInterval","inputControlTimer","popupSimplePressToGo","labelString","simplePressToGoDialogNode","instantiate","setPosition","v2","setScale","getScale","simplePressToGoDialogScriptIns","getComponent","yesButton","getChildByName","postDismissalByYes","transitToState","removeChild","string","once","dismissDialog","bind","safelyAddChild","onLoad","lastRoomDownsyncFrameId","mapNode","node","parent","director","getCollisionManager","enabled","enabledDebugDraw","CC_DEBUG","otherPlayerNodeDict","confirmLogoutNode","width","height","clientUpsyncFps","handleClientSessionCloseOrError","sys","localStorage","handleDownsyncRoomFrame","boundRoomId","removeItem","millisToGo","js","formatStr","setTimeout","loadScene","initPersistentSessionClient","state","tiledMapIns","TiledMap","parse","playerId","spawnSelfPlayer","_inputControlEnabled","setupInputControls","boundaryObjs","tileCollisionManager","extractBoundaryObjects","frameAnimations","frameAnim","animNode","anim","Animation","posInMapNode","sizeInMapNode","origSize","setAnchorPoint","setLocalZOrder","addClip","animationClip","play","barrierColliders","barriers","boundaryObj","newBarrier","newBoundaryOffsetInMapNode","newBarrierColliderIns","PolygonCollider","points","p","push","sub","addChild","allLayers","getLayers","layer","layerType","getProperty","allObjectGroups","getObjectGroups","objectGroup","objectGroupType","sheltersZReducer","newShelter","newShelterColliderIns","setInterval","roomDownsyncFrame","parseInt","countdownNanos","toString","frameId","logout","sentAt","refFrameId","players","playerIdStrList","Object","keys","i","length","k","anotherPlayer","renderAnotherControlledPlayer","mapIns","targetNode","speed","newPos","toFixed","log","newScheduledDirection","ctrl","discretizeDirection","joyStickEps","scheduleNewDirection","joystickInputControllerScriptIns","inputControlPollerMillis","pollerFps","newScheduledDirectionInWorldCoordinate","activeDirection","dPjX","dPjY","newScheduledDirectionInLocalCoordinate","enableInputControls","disableInputControls","newPlayer","uid","update","dt","s","requestContent","intAuthToken","NetworkUtils","ajax","url","backendAddress","PROTOCOL","HOST","PORT","constants","ROUTE_PATH","API","PLAYER","VERSION","INT_AUTH_TOKEN","LOGOUT","success","res","ret","RET_CODE","OK","closeFlag","closeWSConnection","onLogoutClicked","evt","onLogoutConfirmationDismissed"],"mappings":"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","file":"Map.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["const i18n = require('LanguageData');\ni18n.init(window.language); // languageID should be equal to the one we input in New Language ID input field\n\nwindow.ALL_MAP_STATES = {\n  VISUAL: 0, // For free dragging & zooming.\n  EDITING_BELONGING: 1,\n  SHOWING_MODAL_POPUP: 2,\n};\n\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    selfPlayer: null,\n    canvasNode: {\n      type: cc.Node,\n      default: null,\n    },\n    tiledAnimPrefab: {\n      type: cc.Prefab,\n      default: null, \n    },\n    selfPlayerPrefab: {\n      type: cc.Prefab,\n      default: null, \n    },\n    npcPlayerPrefab: {\n      type: cc.Prefab,\n      default: null, \n    },\n    type2NpcPlayerPrefab: {\n      type: cc.Prefab,\n      default: null, \n    },\n    barrierPrefab: {\n      type: cc.Prefab,\n      default: null, \n    },\n    shelterPrefab: {\n      type: cc.Prefab,\n      default: null, \n    },\n    shelterZReducerPrefab: {\n      type: cc.Prefab,\n      default: null, \n    },\n    keyboardInputControllerNode: {\n      type: cc.Node,\n      default: null\n    },\n    joystickInputControllerNode: {\n      type: cc.Node,\n      default: null\n    },\n    confirmLogoutPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    simplePressToGoDialogPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    boundRoomIdLabel: {\n      type: cc.Label,\n      default: null\n    },\n    countdownLabel: {\n      type: cc.Label,\n      default: null\n    },\n  },\n\n  _onPerUpsyncFrame() {\n    const instance = this; \n    if (\n      null == instance.selfPlayerId ||\n      null == instance.selfPlayerScriptIns ||\n      null == instance.selfPlayerScriptIns.scheduledDirection\n    ) return;\n    const upsyncFrameData = {\n      id: instance.selfPlayerId,\n      dir: {\n        dx: parseFloat(instance.selfPlayerScriptIns.scheduledDirection.dx),\n        dy: parseFloat(instance.selfPlayerScriptIns.scheduledDirection.dy),\n      },\n      x: parseFloat(instance.selfPlayer.x),\n      y: parseFloat(instance.selfPlayer.y), \n    };\n    const wrapped = {\n      msgId: Date.now(),\n      act: \"PlayerUpsyncCmd\",\n      data: upsyncFrameData, \n    }\n    window.clientSession.send(JSON.stringify(wrapped)); \n  },\n\n  // LIFE-CYCLE CALLBACKS:\n  onDestroy() {\n    const self = this;\n    if (self.upsyncLoopInterval) {\n      clearInterval(self.upsyncLoopInterval);\n    }\n    if (self.inputControlTimer) {\n      clearInterval(self.inputControlTimer)\n    }\n  },\n\n  popupSimplePressToGo(labelString) {\n    const self = this;\n    const canvasNode = self.canvasNode;\n    const simplePressToGoDialogNode = cc.instantiate(self.simplePressToGoDialogPrefab);\n    simplePressToGoDialogNode.setPosition(cc.v2(0, 0));\n    simplePressToGoDialogNode.setScale(1 / canvasNode.getScale());\n    const simplePressToGoDialogScriptIns = simplePressToGoDialogNode.getComponent(\"SimplePressToGoDialog\");\n    const yesButton = simplePressToGoDialogNode.getChildByName(\"Yes\");\n    const postDismissalByYes = () => {\n      self.transitToState(ALL_MAP_STATES.VISUAL);\n      canvasNode.removeChild(simplePressToGoDialogNode);\n    }\n    simplePressToGoDialogNode.getChildByName(\"Hint\").getComponent(cc.Label).string = labelString;\n    yesButton.once(\"click\", simplePressToGoDialogScriptIns.dismissDialog.bind(simplePressToGoDialogScriptIns, postDismissalByYes));\n    yesButton.getChildByName(\"Label\").getComponent(cc.Label).string = \"OK\";\n    self.transitToState(ALL_MAP_STATES.SHOWING_MODAL_POPUP);\n    simplePressToGoDialogNode.setScale(1 / canvasNode.getScale());\n    safelyAddChild(canvasNode, simplePressToGoDialogNode);\n  },\n\n  onLoad() {\n    const self = this;\n    self.lastRoomDownsyncFrameId = 0;\n    const mapNode = self.node;\n    const canvasNode = mapNode.parent;\n    cc.director.getCollisionManager().enabled = true;\n    cc.director.getCollisionManager().enabledDebugDraw = CC_DEBUG;\n\n    self.otherPlayerNodeDict = {};\n    self.confirmLogoutNode = cc.instantiate(self.confirmLogoutPrefab);\n    self.confirmLogoutNode.getComponent(\"ConfirmLogout\").mapNode = self.node;\n    self.confirmLogoutNode.width = canvasNode.width;\n    self.confirmLogoutNode.height = canvasNode.height;\n\n    self.clientUpsyncFps = 24;\n    self.upsyncLoopInterval = null;\n\n    window.handleClientSessionCloseOrError = function() {\n      if (null != cc.sys.localStorage.selfPlayer) {\n        window.handleDownsyncRoomFrame = null;\n        window.boundRoomId = null;\n        cc.sys.localStorage.removeItem(\"selfPlayer\");\n      } \n      const millisToGo = 3000;\n      self.popupSimplePressToGo(cc.js.formatStr(\"Client session closed unexpectedly! Will logout in %s seconds.\", millisToGo/1000));\n      setTimeout(() => {\n        cc.director.loadScene('login');\n      }, millisToGo);\n    }; \n\n    initPersistentSessionClient(() => {\n      self.state = ALL_MAP_STATES.VISUAL;\n      const tiledMapIns = self.node.getComponent(cc.TiledMap); \n      self.selfPlayerId = JSON.parse(cc.sys.localStorage.selfPlayer).playerId;\n      self.spawnSelfPlayer();\n      self.selfPlayerScriptIns = self.selfPlayer.getComponent(\"SelfPlayer\");\n      this._inputControlEnabled = true;\n      self.setupInputControls();\n\n      const boundaryObjs = tileCollisionManager.extractBoundaryObjects(self.node); \n      for (let frameAnim of boundaryObjs.frameAnimations) {\n        const animNode = cc.instantiate(self.tiledAnimPrefab);  \n        const anim = animNode.getComponent(cc.Animation); \n        animNode.setPosition(frameAnim.posInMapNode);\n        animNode.width = frameAnim.sizeInMapNode.width;\n        animNode.height = frameAnim.sizeInMapNode.height;\n        animNode.setScale(frameAnim.sizeInMapNode.width/frameAnim.origSize.width, frameAnim.sizeInMapNode.height/frameAnim.origSize.height);\n        animNode.setAnchorPoint(cc.v2(0.5, 0)); // A special requirement for \"image-type Tiled object\" by \"CocosCreator v2.0.1\".\n        safelyAddChild(self.node, animNode);  \n        setLocalZOrder(animNode, 5);  \n        anim.addClip(frameAnim.animationClip, \"default\");\n        anim.play(\"default\");\n      } \n\n      self.barrierColliders = [];\n      for (let boundaryObj of boundaryObjs.barriers) {\n        const newBarrier = cc.instantiate(self.barrierPrefab);\n        const newBoundaryOffsetInMapNode = cc.v2(boundaryObj[0].x, boundaryObj[0].y); \n        newBarrier.setPosition(newBoundaryOffsetInMapNode);\n        newBarrier.setAnchorPoint(cc.v2(0, 0));\n        const newBarrierColliderIns = newBarrier.getComponent(cc.PolygonCollider); \n        newBarrierColliderIns.points = [];\n        for (let p of boundaryObj) {\n          newBarrierColliderIns.points.push(p.sub(newBoundaryOffsetInMapNode)); \n        }  \n        self.barrierColliders.push(newBarrierColliderIns);\n        self.node.addChild(newBarrier);\n      }\n\n      const allLayers = tiledMapIns.getLayers();\n      for (let layer of allLayers) {\n        const layerType = layer.getProperty(\"type\"); \n        switch (layerType) {\n          case \"normal\":\n            setLocalZOrder(layer.node, 0);\n            break;\n          case \"barrier_and_shelter\":\n            setLocalZOrder(layer.node, 3);\n            break;\n          default:\n            break;\n        }\n      }\n\n      const allObjectGroups = tiledMapIns.getObjectGroups(); \n      for (let objectGroup of allObjectGroups) {\n        const objectGroupType = objectGroup.getProperty(\"type\"); \n        switch (objectGroupType) {\n          case \"barrier_and_shelter\":\n            setLocalZOrder(objectGroup.node, 3);\n            break;\n          default:\n            break;\n        }\n      }\n\n      if (this.joystickInputControllerNode.parent !== this.node.parent.parent.getChildByName('JoystickContainer')) {\n        this.joystickInputControllerNode.parent = this.node.parent.parent.getChildByName('JoystickContainer');\n      }\n      this.joystickInputControllerNode.parent.width = this.node.parent.width * 0.5;\n      this.joystickInputControllerNode.parent.height = this.node.parent.height;\n\n      for (let boundaryObj of boundaryObjs.sheltersZReducer) {\n        const newShelter = cc.instantiate(self.shelterZReducerPrefab);\n        const newBoundaryOffsetInMapNode = cc.v2(boundaryObj[0].x, boundaryObj[0].y); \n        newShelter.setPosition(newBoundaryOffsetInMapNode);\n        newShelter.setAnchorPoint(cc.v2(0, 0));\n        const newShelterColliderIns = newShelter.getComponent(cc.PolygonCollider); \n        newShelterColliderIns.points = [];\n        for (let p of boundaryObj) {\n          newShelterColliderIns.points.push(p.sub(newBoundaryOffsetInMapNode)); \n        }  \n        self.node.addChild(newShelter);\n      }\n      self.upsyncLoopInterval = setInterval(self._onPerUpsyncFrame.bind(self), self.clientUpsyncFps);\n      window.handleDownsyncRoomFrame = function(roomDownsyncFrame) {\n        self.countdownLabel.string = parseInt(roomDownsyncFrame.countdownNanos/1000000000).toString();\n        const frameId = roomDownsyncFrame.id;\n        if (frameId <= self.lastRoomDownsyncFrameId) return;\n        if (roomDownsyncFrame.countdownNanos == -1) {\n          const millisToGo = 3000;\n          self.popupSimplePressToGo(cc.js.formatStr(\"Battle stopped! Will logout in %s seconds.\", millisToGo/1000));\n          setTimeout(() => {\n            self.logout();\n          }, millisToGo);\n        }\n        if (0 == self.lastRoomDownsyncFrameId) {\n          self.popupSimplePressToGo(\"Battle started!\");\n        }\n        self.lastRoomDownsyncFrameId = frameId;\n        const sentAt = roomDownsyncFrame.sentAt;\n        const refFrameId = roomDownsyncFrame.refFrameId;\n        const players = roomDownsyncFrame.players;\n        const playerIdStrList = Object.keys(players);\n        for (let i = 0; i < playerIdStrList.length; ++i) {\n          const k = playerIdStrList[i];\n          const playerId = parseInt(k);\n          if (playerId == self.selfPlayerId) continue;\n          const anotherPlayer = players[k]; \n          self.renderAnotherControlledPlayer(self, anotherPlayer);\n        } \n      };\n    });\n  },\n\n  renderAnotherControlledPlayer: (mapIns, anotherPlayer) => {\n    const mapNode = mapIns.node;\n\n    let targetNode = mapIns.otherPlayerNodeDict[anotherPlayer.id];\n    if (!targetNode) {\n      targetNode = cc.instantiate(mapIns.selfPlayerPrefab);\n      targetNode.getComponent(\"SelfPlayer\").mapNode = mapNode;\n      targetNode.getComponent(\"SelfPlayer\").speed = 0; // To prevent jittering.\n      mapNode.addChild(targetNode);\n      setLocalZOrder(targetNode, 5);\n      mapIns.otherPlayerNodeDict[anotherPlayer.id] = targetNode;\n    }\n    const newPos = cc.v2(\n      parseFloat(parseFloat(anotherPlayer.x).toFixed(6)), \n      parseFloat(parseFloat(anotherPlayer.y).toFixed(6))\n    );\n    cc.log(`Rendering anotherPlayer ${anotherPlayer.id} at <${newPos.x}, ${newPos.y}> and orientation ${JSON.stringify(anotherPlayer.dir)}`)\n    targetNode.setPosition(newPos);\n    if (0 != anotherPlayer.dir.dx || 0 != anotherPlayer.dir.dy) { \n      const newScheduledDirection = mapIns.ctrl.discretizeDirection(anotherPlayer.dir.dx, anotherPlayer.dir.dy, mapIns.ctrl.joyStickEps);  \n      targetNode.getComponent(\"SelfPlayer\").scheduleNewDirection(newScheduledDirection, true);\n    }\n  }, \n\n  setupInputControls() {\n    const instance = this;\n    const mapNode = instance.node;\n    const canvasNode = mapNode.parent;\n    const joystickInputControllerScriptIns = canvasNode.getComponent(\"TouchEventsManager\");\n    const inputControlPollerMillis = (1000 / joystickInputControllerScriptIns.pollerFps);\n\n    const selfPlayerScriptIns = instance.selfPlayerScriptIns;\n\n    const ctrl = joystickInputControllerScriptIns;\n    instance.ctrl = ctrl;\n\n    instance.inputControlTimer = setInterval(function() {\n      if (false == instance._inputControlEnabled) return;\n\n      const newScheduledDirectionInWorldCoordinate = {\n        dx: ctrl.activeDirection.dPjX,\n        dy: ctrl.activeDirection.dPjY\n      };\n\n      const newScheduledDirectionInLocalCoordinate = newScheduledDirectionInWorldCoordinate;\n      selfPlayerScriptIns.scheduleNewDirection(newScheduledDirectionInLocalCoordinate);\n    }, inputControlPollerMillis);\n  },\n\n  enableInputControls() {\n    this._inputControlEnabled = true; \n  },\n\n  disableInputControls() {\n    this._inputControlEnabled = false;\n  },\n\n  spawnSelfPlayer() {\n    const instance = this;\n    const newPlayer = cc.instantiate(instance.selfPlayerPrefab);\n    newPlayer.uid = 0;\n    newPlayer.setPosition(cc.v2(0, 0));\n    newPlayer.getComponent(\"SelfPlayer\").mapNode = instance.node;\n\n    instance.node.addChild(newPlayer);\n\n    setLocalZOrder(newPlayer, 5);\n    instance.selfPlayer = newPlayer;\n  },\n\n  update(dt) {\n    const self = this;\n    if (null != window.boundRoomId) {\n      self.boundRoomIdLabel.string = window.boundRoomId;  \n    }\n  },\n\n  transitToState(s) {\n    const self = this;\n    self.state = s;\n  },\n\n  logout() {\n    // Will be called within \"ConfirmLogou.js\".\n    const self = this;\n    const selfPlayer = JSON.parse(cc.sys.localStorage.selfPlayer);\n    const requestContent = {\n      intAuthToken: selfPlayer.intAuthToken\n    }\n    NetworkUtils.ajax({\n      url: backendAddress.PROTOCOL + '://' + backendAddress.HOST + ':' + backendAddress.PORT + constants.ROUTE_PATH.API + constants.ROUTE_PATH.PLAYER + constants.ROUTE_PATH.VERSION + constants.ROUTE_PATH.INT_AUTH_TOKEN + constants.ROUTE_PATH.LOGOUT,\n      type: \"POST\",\n      data: requestContent,\n      success: function(res) {\n        if (res.ret != constants.RET_CODE.OK) {\n          cc.log(`Logout failed: ${res}.`);\n        }\n        self.closeFlag = true;\n        window.closeWSConnection();\n        cc.sys.localStorage.removeItem('selfPlayer');\n        cc.director.loadScene('login');\n      }\n    });\n  },\n\n  onLogoutClicked(evt) {\n    const self = this;\n    self.disableInputControls();\n    self.transitToState(ALL_MAP_STATES.SHOWING_MODAL_POPUP);\n    const canvasNode = self.canvasNode;\n    self.confirmLogoutNode.setScale(1 / canvasNode.getScale());\n    safelyAddChild(canvasNode, self.confirmLogoutNode);\n    setLocalZOrder(self.confirmLogoutNode, 10);\n  },\n\n  onLogoutConfirmationDismissed() {\n    const self = this;\n    self.transitToState(ALL_MAP_STATES.VISUAL);\n    const canvasNode = self.canvasNode;\n    canvasNode.removeChild(self.confirmLogoutNode);\n    self.enableInputControls();\n  },\n});\n\n"]}