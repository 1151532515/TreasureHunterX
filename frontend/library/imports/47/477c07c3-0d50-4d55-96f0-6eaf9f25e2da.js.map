{"version":3,"sources":["..\\..\\..\\..\\assets\\plugin_scripts/assets\\plugin_scripts\\NetworkDoctor.js"],"names":["NetworkDoctor","serverFps","clientUpsyncFps","millisPerServerFrame","parseInt","_tooLongSinceLastFrameDiffReceivedThreshold","setupFps","fps","_lastFrameDiffRecvTime","_tooLongSinceLastFrameDiffReceived","undefined","Date","now","_consecutiveALittleLongFrameDiffReceivedIntervalCount","_consecutiveALittleLongFrameDiffReceivedIntervalCountThreshold","onNewFrameDiffReceived","frameDiff","intervalFromLastFrameDiff","console","log","_networkComplaintPrefix","generateNetworkComplaint","excludeTypeConstantALittleLongFrameDiffReceivedInterval","excludeTypeTooLongSinceLastFrameDiffReceived","hasBattleStopped","shouldComplain","ret","onBattleStopped","isClientSessionConnected","window","game","clientSession","connected"],"mappings":";;;;;;AAAA,SAASA,aAAT,CAAuBC,SAAvB,EAAkCC,eAAlC,EAAmD;AACjD,OAAKD,SAAL,GAAiBA,SAAjB;AACA,OAAKC,eAAL,GAAuBA,eAAvB;AACA,OAAKC,oBAAL,GAA4BC,SAAS,OAAO,KAAKH,SAArB,CAA5B;AACA,OAAKI,2CAAL,GAAoD,KAAKF,oBAAL,IAA6B,CAAjF;;AAEA,OAAKG,QAAL,GAAgB,UAASC,GAAT,EAAc;AAC5B,SAAKN,SAAL,GAAiB,KAAKC,eAAL,GAAuBK,GAAxC;AACA,SAAKJ,oBAAL,GAA4BC,SAAS,OAAO,KAAKH,SAArB,CAA5B;AACA,SAAKI,2CAAL,GAAoD,KAAKF,oBAAL,IAA6B,CAAjF;AACD,GAJD;;AAMA,OAAKK,sBAAL,GAA8B,IAA9B;AACA,OAAKC,kCAAL,GAA0C,YAAW;AACnD,QAAIC,cAAc,KAAKF,sBAAnB,IAA6C,SAAS,KAAKA,sBAA/D,EAAuF,OAAO,KAAP;AACvF,WAAQ,KAAKH,2CAAL,IAAqDM,KAAKC,GAAL,KAAa,KAAKJ,sBAA/E;AACD,GAHD;;AAKA,OAAKK,qDAAL,GAA6D,CAA7D;AACA,OAAKC,8DAAL,GAAsE,GAAtE;;AAEA,OAAKC,sBAAL,GAA8B,UAASC,SAAT,EAAoB;AAChD,QAAIJ,MAAMD,KAAKC,GAAL,EAAV;AACA,QAAIF,cAAc,KAAKF,sBAAnB,IAA6C,SAAS,KAAKA,sBAA/D,EAAuF;AACrF,UAAIS,4BAA6BL,MAAM,KAAKJ,sBAA5C;AACA,UAAK,KAAKL,oBAAL,IAA6B,CAA9B,GAAmCc,yBAAvC,EAAkE;AAChE,UAAE,KAAKJ,qDAAP;AACAK,gBAAQC,GAAR,CAAY,4CAAZ,EAA0DF,yBAA1D;AACD,OAHD,MAGO;AACL,aAAKJ,qDAAL,GAA6D,CAA7D;AACD;AACF;AACD,SAAKL,sBAAL,GAA8BI,GAA9B;AACD,GAZD;;AAcA,OAAKQ,uBAAL,GAA+B,6BAA/B;;AAEA,OAAKC,wBAAL,GAAgC,UAASC,uDAAT,EAAkEC,4CAAlE,EAAgH;AAC9I,QAAI,KAAKC,gBAAT,EAA2B,OAAO,IAAP;AAC3B,QAAIC,iBAAiB,KAArB;AACA,QAAIC,MAAM,KAAKN,uBAAf;AACA,QAAI,QAAQE,uDAAR,IAAmE,KAAKR,8DAAL,IAAuE,KAAKD,qDAAnJ,EAA0M;AACxM,WAAKA,qDAAL,GAA6D,CAA7D;AACAa,aAAO,oDAAP;AACAD,uBAAiB,IAAjB;AACD;AACD,QAAI,QAAQF,4CAAR,IAAwD,KAAKd,kCAAL,EAA5D,EAAuG;AACrGiB,aAAO,6CAAP;AACAD,uBAAiB,IAAjB;AACD;AACD,WAAQA,iBAAiBC,GAAjB,GAAuB,IAA/B;AACD,GAdD;;AAgBA,OAAKF,gBAAL,GAAwB,KAAxB;AACA,OAAKG,eAAL,GAAuB,YAAW;AAChC,SAAKH,gBAAL,GAAwB,IAAxB;AACD,GAFD;;AAIA,OAAKI,wBAAL,GAAgC,YAAW;AACzC,QAAI,CAACC,OAAOC,IAAZ,EAAkB,OAAO,KAAP;AAClB,QAAI,CAACD,OAAOC,IAAP,CAAYC,aAAjB,EAAgC,OAAO,KAAP;AAChC,WAAOF,OAAOC,IAAP,CAAYC,aAAZ,CAA0BC,SAAjC;AACD,GAJD;AAKD;;AAEDH,OAAO7B,aAAP,GAAuBA,aAAvB","file":"NetworkDoctor.js","sourceRoot":"..\\..\\..\\..\\assets\\plugin_scripts","sourcesContent":["function NetworkDoctor(serverFps, clientUpsyncFps) {\r\n  this.serverFps = serverFps;\r\n  this.clientUpsyncFps = clientUpsyncFps;\r\n  this.millisPerServerFrame = parseInt(1000 / this.serverFps);\r\n  this._tooLongSinceLastFrameDiffReceivedThreshold = (this.millisPerServerFrame << 6);\r\n\r\n  this.setupFps = function(fps) {\r\n    this.serverFps = this.clientUpsyncFps = fps;\r\n    this.millisPerServerFrame = parseInt(1000 / this.serverFps);\r\n    this._tooLongSinceLastFrameDiffReceivedThreshold = (this.millisPerServerFrame << 6);\r\n  }\r\n\r\n  this._lastFrameDiffRecvTime = null;\r\n  this._tooLongSinceLastFrameDiffReceived = function() {\r\n    if (undefined === this._lastFrameDiffRecvTime || null === this._lastFrameDiffRecvTime) return false;\r\n    return (this._tooLongSinceLastFrameDiffReceivedThreshold <= (Date.now() - this._lastFrameDiffRecvTime));\r\n  };\r\n\r\n  this._consecutiveALittleLongFrameDiffReceivedIntervalCount = 0;\r\n  this._consecutiveALittleLongFrameDiffReceivedIntervalCountThreshold = 120;\r\n\r\n  this.onNewFrameDiffReceived = function(frameDiff) {\r\n    var now = Date.now();\r\n    if (undefined !== this._lastFrameDiffRecvTime && null !== this._lastFrameDiffRecvTime) {\r\n      var intervalFromLastFrameDiff = (now - this._lastFrameDiffRecvTime);\r\n      if ((this.millisPerServerFrame << 5) < intervalFromLastFrameDiff) {\r\n        ++this._consecutiveALittleLongFrameDiffReceivedIntervalCount;\r\n        console.log('Medium delay, intervalFromLastFrameDiff is', intervalFromLastFrameDiff);\r\n      } else {\r\n        this._consecutiveALittleLongFrameDiffReceivedIntervalCount = 0;\r\n      }\r\n    }\r\n    this._lastFrameDiffRecvTime = now;\r\n  };\r\n\r\n  this._networkComplaintPrefix = \"\\nNetwork is not good >_<\\n\";\r\n\r\n  this.generateNetworkComplaint = function(excludeTypeConstantALittleLongFrameDiffReceivedInterval, excludeTypeTooLongSinceLastFrameDiffReceived) {\r\n    if (this.hasBattleStopped) return null;\r\n    var shouldComplain = false;\r\n    var ret = this._networkComplaintPrefix;\r\n    if (true != excludeTypeConstantALittleLongFrameDiffReceivedInterval && this._consecutiveALittleLongFrameDiffReceivedIntervalCountThreshold <= this._consecutiveALittleLongFrameDiffReceivedIntervalCount) {\r\n      this._consecutiveALittleLongFrameDiffReceivedIntervalCount = 0;\r\n      ret += \"\\nConstantly having a little long recv interval.\\n\";\r\n      shouldComplain = true;\r\n    }\r\n    if (true != excludeTypeTooLongSinceLastFrameDiffReceived && this._tooLongSinceLastFrameDiffReceived()) {\r\n      ret += \"\\nToo long since last received frameDiff.\\n\";\r\n      shouldComplain = true;\r\n    }\r\n    return (shouldComplain ? ret : null);\r\n  };\r\n\r\n  this.hasBattleStopped = false;\r\n  this.onBattleStopped = function() {\r\n    this.hasBattleStopped = true;\r\n  };\r\n\r\n  this.isClientSessionConnected = function() {\r\n    if (!window.game) return false;\r\n    if (!window.game.clientSession) return false;\r\n    return window.game.clientSession.connected; \r\n  };\r\n}\r\n\r\nwindow.NetworkDoctor = NetworkDoctor;\r\n"]}