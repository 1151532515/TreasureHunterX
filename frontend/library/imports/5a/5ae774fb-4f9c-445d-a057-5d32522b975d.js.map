{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\ResultPanel.js"],"names":["i18n","require","init","window","language","cc","Class","extends","Component","properties","onCloseDelegate","type","Object","default","onAgainClicked","winnerPanel","Node","loserPanel","resultCompareNode","onLoad","resultPanelNode","node","againButtonNode","getChildByName","homeButtonNode","againBtnOnClick","evt","onClose","homeBtnOnClick","closeWSConnection","director","loadScene","showPlayerInfo","players","winnerNameNode","loserNameNode","compareProgressNode","winnerInfo","loserInfo","playerId","playerInfo","score","getComponent","Label","string","joinIndex","progressComp","ProgressBar","winnerScore","parseInt","loserScore","ratio","Math","abs","progress","plistDir","loader","loadRes","SpriteAtlas","err","altas","warn","winnerAvatar","getSpriteFrame","loserAvatar","Sprite","spriteFrame","showRibbon","ribbonNode","selfPlayerInfo","JSON","parse","sys","localStorage","selfPlayer","texture","id","SpriteFrame","console","log","parent","removeChild"],"mappings":"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","file":"ResultPanel.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["const i18n = require('LanguageData');\r\ni18n.init(window.language); // languageID should be equal to the one we input in New Language ID input field\r\ncc.Class({\r\n\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    onCloseDelegate: {\r\n      type: cc.Object,\r\n      default: null\r\n    },\r\n    onAgainClicked: {\r\n      type: cc.Object,\r\n      default: null\r\n    },\r\n    winnerPanel: {\r\n      type: cc.Node,\r\n      default: null\r\n    },\r\n    loserPanel: {\r\n      type: cc.Node,\r\n      default: null\r\n    },\r\n    resultCompareNode: {\r\n      type: cc.Node,\r\n      default: null\r\n    }\r\n  },\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n\r\n  onLoad() {\r\n    const resultPanelNode = this.node;\r\n    const againButtonNode = resultPanelNode.getChildByName(\"againBtn\");  \r\n    const homeButtonNode = resultPanelNode.getChildByName(\"homeBtn\");  \r\n  },\r\n\r\n  againBtnOnClick(evt) {\r\n    this.onClose();\r\n    if (!this.onAgainClicked) return;\r\n    this.onAgainClicked();\r\n  },\r\n\r\n  homeBtnOnClick(evt) {\r\n    window.closeWSConnection();\r\n    cc.director.loadScene('login');\r\n  },\r\n\r\n  showPlayerInfo(players) {\r\n    const resultPanelNode = this.node;\r\n    const winnerNameNode = resultPanelNode.getChildByName(\"winnerName\");\r\n    const loserNameNode = resultPanelNode.getChildByName(\"loserName\");\r\n    const resultCompareNode = this.resultCompareNode;\r\n    const compareProgressNode = resultCompareNode.getChildByName(\"progressbar\");\r\n    let winnerInfo = null;\r\n    let loserInfo = null;\r\n    \r\n    for(let playerId in players) {\r\n      const playerInfo = players[playerId];\r\n      if(!winnerInfo) {\r\n        winnerInfo =  playerInfo; \r\n        continue;\r\n      }\r\n      if(playerInfo.score >= winnerInfo.score) {\r\n        loserInfo = winnerInfo;\r\n        winnerInfo = playerInfo;\r\n      }else {\r\n        loserInfo = playerInfo;\r\n      }\r\n    }\r\n    //TODO Hardecode the name\r\n    winnerNameNode.getComponent(cc.Label).string = \"Player\" + winnerInfo.joinIndex;\r\n    loserNameNode.getComponent(cc.Label).string = \"Player\" + loserInfo.joinIndex;\r\n  \r\n    const progressComp = compareProgressNode.getComponent(cc.ProgressBar);\r\n    const winnerScore = parseInt(winnerInfo.score);\r\n    const loserScore = parseInt(loserInfo.score); \r\n    let ratio = 0.5; \r\n    if(winnerScore != loserScore){\r\n      ratio = (loserScore * winnerScore <= 0) ? 1 \r\n              : Math.abs(winnerScore) / Math.abs((loserScore + winnerScore));\r\n    }\r\n    progressComp.progress = ratio; \r\n    \r\n    resultCompareNode.getChildByName(\"winnerScore\").getComponent(cc.Label).string = winnerScore;\r\n    resultCompareNode.getChildByName(\"loserScore\").getComponent(cc.Label).string = loserScore;\r\n    \r\n   const plistDir = \"textures/StatusBar\";\r\n\r\n   cc.loader.loadRes(plistDir, cc.SpriteAtlas, function (err, altas) {\r\n    if(err){\r\n      cc.warn(err);\r\n      return;\r\n    }\r\n    //hardecode avatart by joinIndex\r\n    let winnerAvatar = altas.getSpriteFrame(winnerInfo.joinIndex == 2 ? \"BlueAvatar\" : \"RedAvatar\")\r\n    let loserAvatar = altas.getSpriteFrame(loserInfo.joinIndex == 2 ? \"BlueAvatar\" : \"RedAvatar\")\r\n    resultPanelNode.getChildByName(\"winnerPortrait\").getComponent(cc.Sprite).spriteFrame = winnerAvatar;\r\n    resultPanelNode.getChildByName(\"loserPortrait\").getComponent(cc.Sprite).spriteFrame = loserAvatar;\r\n   });\r\n\r\n   this.showRibbon(winnerInfo, resultPanelNode.getChildByName(\"ribbon\"));  \r\n  },\r\n \r\n  showRibbon(winnerInfo, ribbonNode) {\r\n    const selfPlayerInfo = JSON.parse(cc.sys.localStorage.selfPlayer);\r\n    const texture = (selfPlayerInfo.playerId == winnerInfo.id) ? \"textures/resultPanel/WinRibbon\" : \"textures/resultPanel/loseRibbon\";\r\n    cc.loader.loadRes(texture, cc.SpriteFrame, function (err, spriteFrame) {\r\n      if(err) {\r\n        console.log(err);\r\n        return;\r\n      }\r\n      ribbonNode.getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n    });\r\n\r\n  },\r\n  \r\n  onClose(evt) {\r\n    if (this.node.parent) {\r\n      this.node.parent.removeChild(this.node); \r\n    }\r\n    if (!this.onCloseDelegate) { \r\n      return;\r\n    }\r\n    this.onCloseDelegate();\r\n  }\r\n});\r\n"]}