{"version":3,"sources":["../../../../assets/scripts/assets/scripts/ResultPanel.js"],"names":["i18n","require","init","window","language","cc","Class","extends","Component","properties","onCloseDelegate","type","Object","default","winnerPanel","Node","loserPanel","resultCompareNode","onLoad","resultPanelNode","node","againButtonNode","getChildByName","homeButtonNode","againBtnOnClick","evt","closeWSConnection","clearBoundRoomIdInBothVolatileAndPersistentStorage","sys","localStorage","removeItem","director","loadScene","homeBtnOnClick","showPlayerInfo","players","winnerNameNode","loserNameNode","compareProgressNode","winnerInfo","loserInfo","playerId","playerInfo","score","getComponent","Label","string","name","progressComp","ProgressBar","winnerScore","parseInt","loserScore","ratio","Math","abs","progress","showRibbon","ribbonNode","selfPlayerInfo","JSON","parse","selfPlayer","texture","id","loader","loadRes","SpriteFrame","err","spriteFrame","console","log","Sprite","onClose","active"],"mappings":"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","file":"ResultPanel.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["const i18n = require('LanguageData');\ni18n.init(window.language); // languageID should be equal to the one we input in New Language ID input field\ncc.Class({\n\n  extends: cc.Component,\n\n  properties: {\n    onCloseDelegate: {\n      type: cc.Object,\n      default: null\n    },\n    winnerPanel: {\n      type: cc.Node,\n      default: null\n    },\n    loserPanel: {\n      type: cc.Node,\n      default: null\n    },\n    resultCompareNode: {\n      type: cc.Node,\n      default: null\n    }\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    const resultPanelNode = this.node;\n    const againButtonNode = resultPanelNode.getChildByName(\"againBtn\");  \n    const homeButtonNode = resultPanelNode.getChildByName(\"homeBtn\");  \n  },\n\n  againBtnOnClick(evt) {\n      window.closeWSConnection();\n      window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\n      cc.sys.localStorage.removeItem('selfPlayer');\n      cc.director.loadScene('login');\n  },\n\n  homeBtnOnClick(evt) {\n      window.closeWSConnection();\n      window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\n      cc.sys.localStorage.removeItem('selfPlayer');\n      cc.director.loadScene('login');\n  },\n  showPlayerInfo(players) {\n    const resultPanelNode = this.node;\n    const winnerNameNode = resultPanelNode.getChildByName(\"winnerName\");\n    const loserNameNode = resultPanelNode.getChildByName(\"loserName\");\n    const resultCompareNode = this.resultCompareNode;\n    const compareProgressNode = resultCompareNode.getChildByName(\"progressbar\");\n    let winnerInfo = null;\n    let loserInfo = null;\n    \n    for(let playerId in players) {\n      const playerInfo = players[playerId];\n      if(!winnerInfo) {\n        winnerInfo =  playerInfo; \n        continue;\n      }\n      if(playerInfo.score >= winnerInfo.score) {\n        loserInfo = winnerInfo;\n        winnerInfo = playerInfo;\n      }else {\n        loserInfo = playerInfo;\n      }\n    }\n    winnerNameNode.getComponent(cc.Label).string = winnerInfo.name;\n    loserNameNode.getComponent(cc.Label).string = loserInfo.name;\n  \n    const progressComp = compareProgressNode.getComponent(cc.ProgressBar);\n    const winnerScore = parseInt(winnerInfo.score);\n    const loserScore = parseInt(loserInfo.score); \n    let ratio = 0.5; \n    if(winnerScore != loserScore){\n      ratio = (loserScore * winnerScore <= 0) ? 1 \n              : Math.abs(winnerScore) / Math.abs((loserScore + winnerScore));\n    }\n    progressComp.progress = ratio; \n    \n    resultCompareNode.getChildByName(\"winnerScore\").getComponent(cc.Label).string = winnerScore;\n    resultCompareNode.getChildByName(\"loserScore\").getComponent(cc.Label).string = loserScore;\n    \n    this.showRibbon(winnerInfo, resultPanelNode.getChildByName(\"ribbon\"));  \n  },\n \n  showRibbon(winnerInfo, ribbonNode) {\n    const selfPlayerInfo = JSON.parse(cc.sys.localStorage.selfPlayer);\n    const texture = (selfPlayerInfo.playerId == winnerInfo.id) ? \"textures/resultPanel/WinRibbon\" : \"textures/resultPanel/loseRibbon\";\n    cc.loader.loadRes(texture, cc.SpriteFrame, function (err, spriteFrame) {\n      if(err) {\n        console.log(err);\n        return;\n      }\n      ribbonNode.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n    });\n  },\n  \n  \n  onClose(evt) {\n    this.node.active = false;\n    if(!this.onCloseDelegate) \n      return;\n    this.onCloseDelegate();\n  }\n});\n"]}