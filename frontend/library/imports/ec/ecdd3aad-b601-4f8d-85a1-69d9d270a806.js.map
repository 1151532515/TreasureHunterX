{"version":3,"sources":["../../../../assets/scripts/assets/scripts/FindingPlayer.js"],"names":["cc","Class","extends","Component","properties","firstPlayerInfoNode","type","Node","default","secondPlayerInfoNode","findingAnimNode","myAvatarNode","onLoad","init","active","playersInfoNode","Object","assign","window","exitBtnOnClick","evt","closeWSConnection","clearBoundRoomIdInBothVolatileAndPersistentStorage","sys","localStorage","removeItem","director","loadScene","updatePlayersInfo","players","i","playerInfo","playerInfoNode","joinIndex","nameNode","getChildByName","getComponent","Label","string","constants","PLAYER_NAME","remoteUrl","avatar","console","log","loader","load","url","err","texture","error","sf","SpriteFrame","setTexture","Sprite","spriteFrame","name"],"mappings":"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","file":"FindingPlayer.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["cc.Class({\n  extends: cc.Component,\n\n  properties: {\n   firstPlayerInfoNode: {\n      type: cc.Node,\n      default: null\n    },\n    secondPlayerInfoNode: {\n      type: cc.Node,\n      default: null\n    },\n    findingAnimNode: {\n      type: cc.Node,\n      default: null\n    },\n    myAvatarNode: {\n      type: cc.Node,\n      default: null\n    },\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n  },\n  init() {\n    this.firstPlayerInfoNode.active = false;\n    this.secondPlayerInfoNode.active = false;\n    this.playersInfoNode = {};\n    Object.assign(this.playersInfoNode, {1: this.firstPlayerInfoNode});\n    Object.assign(this.playersInfoNode, {2: this.secondPlayerInfoNode});\n\n    window.firstPlayerInfoNode = this.firstPlayerInfoNode;\n    this.findingAnimNode.active = true;\n  },\n  exitBtnOnClick(evt) {\n    window.closeWSConnection();\n    window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\n    cc.sys.localStorage.removeItem('selfPlayer');\n    cc.director.loadScene('login');\n  },\n  updatePlayersInfo(players) {\n    if (!players) return;\n    for (let i in players) {\n      const playerInfo = players[i];\n      const playerInfoNode = this.playersInfoNode[playerInfo.joinIndex];\n      const nameNode = playerInfoNode.getChildByName(\"name\");\n      nameNode.getComponent(cc.Label).string = constants.PLAYER_NAME[playerInfo.joinIndex]; \n      playerInfoNode.active = true;\n      if (2 == playerInfo.joinIndex) {\n        this.findingAnimNode.active = false;\n      }\n    }\n\n    //显示自己的头像名称以及他人的头像名称\n    for (let i in players) {\n      const playerInfo = players[i];\n      const playerInfoNode = this.playersInfoNode[playerInfo.joinIndex];\n\n      (() => { //远程加载头像\n        let remoteUrl = playerInfo.avatar;\n        if(remoteUrl == ''){\n          console.log('用户'+ i +' 没有头像, 提供临时头像');\n          remoteUrl = 'http://wx.qlogo.cn/mmopen/xzq2UIB49VaicY1Hk3jDLk6e8nISmsQuEcqxicEMuC1jKx75QnwibDLWnRHoEmMZdKOJWjspUd8aSD8DfoUYLEqQJ6rcHibNP5Gib/0';\n        }\n        cc.loader.load({url: remoteUrl, type: 'jpg'}, function (err, texture) {\n          if(err != null){\n            console.error(err);\n          }else{\n            const sf = new cc.SpriteFrame();\n            sf.setTexture(texture);\n            playerInfoNode.getChildByName('avatarMask').getChildByName('avatar').getComponent(cc.Sprite).spriteFrame = sf;\n          }\n        });\n      })();\n\n\n      const nameNode = playerInfoNode.getChildByName(\"name\");\n      nameNode.getComponent(cc.Label).string = playerInfo.name; \n    }\n  },\n});\n"]}