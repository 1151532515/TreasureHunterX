{"version":3,"sources":["../../../../assets/scripts/assets/scripts/FindingPlayer.js"],"names":["cc","Class","extends","Component","properties","firstPlayerInfoNode","type","Node","default","secondPlayerInfoNode","findingAnimNode","myAvatarNode","onLoad","sys","platform","WECHAT_GAME","console","warn","localStorage","getItem","wx","showShareMenu","onShareAppMessage","title","imageUrl","query","init","active","playersInfoNode","Object","assign","window","exitBtnOnClick","evt","closeWSConnection","clearBoundRoomIdInBothVolatileAndPersistentStorage","removeItem","updatePlayersInfo","players","i","playerInfo","playerInfoNode","joinIndex","log","remoteUrl","avatar","loader","load","url","err","texture","error","sf","SpriteFrame","setTexture","getChildByName","getComponent","Sprite","spriteFrame","isEmptyString","str","nameNode","nameToDisplay","displayName","name","Label","string"],"mappings":"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","file":"FindingPlayer.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["cc.Class({\n  extends: cc.Component,\n\n  properties: {\n    firstPlayerInfoNode: {\n      type: cc.Node,\n      default: null\n    },\n    secondPlayerInfoNode: {\n      type: cc.Node,\n      default: null\n    },\n    findingAnimNode: {\n      type: cc.Node,\n      default: null\n    },\n    myAvatarNode: {\n      type: cc.Node,\n      default: null\n    },\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    //kobako: 初始化小游戏分享\n    //WARN: 不保证在ws连接成功并且拿到boundRoomId后才运行到此处\n    if(cc.sys.platform == cc.sys.WECHAT_GAME){\n      console.warn('kobako: boundRoomId for share: ' + cc.sys.localStorage.getItem('boundRoomId'));\n      wx.showShareMenu();\n      wx.onShareAppMessage(() => ({\n        title: '夺宝大作战',\n        imageUrl: 'https://www.google.com.hk/imgres?imgurl=http%3A%2F%2Fdingyue.nosdn.127.net%2FuPFIW8M3UDCcGfpQWtoCndz8wCHvDtsXnCYlwlPO7QgZ41524836844397.jpg&imgrefurl=https%3A%2F%2F3g.163.com%2Fdy%2Farticle%2FDGEA4E490511MVC3.html&docid=mTpj85Bl0u-5QM&tbnid=IG3pedebx27Y4M%3A&vet=10ahUKEwjsibe58q3hAhWRvJ4KHRu1AhIQMwhOKBMwEw..i&w=870&h=489&safe=strict&bih=815&biw=1745&q=%E5%BE%AE%E4%BF%A1%E5%B0%8F%E6%B8%B8%E6%88%8F%20%E5%88%86%E4%BA%AB&ved=0ahUKEwjsibe58q3hAhWRvJ4KHRu1AhIQMwhOKBMwEw&iact=mrc&uact=8', // 图片 URL\n        query: 'expectedRoomId=' + cc.sys.localStorage.getItem('boundRoomId'),\n      }));\n    }\n\n  },\n  init() {\n    this.firstPlayerInfoNode.active = false;\n    this.secondPlayerInfoNode.active = false;\n    this.playersInfoNode = {};\n    Object.assign(this.playersInfoNode, {\n      1: this.firstPlayerInfoNode\n    });\n    Object.assign(this.playersInfoNode, {\n      2: this.secondPlayerInfoNode\n    });\n\n    window.firstPlayerInfoNode = this.firstPlayerInfoNode;\n    this.findingAnimNode.active = true;\n\n  },\n  exitBtnOnClick(evt) {\n    window.closeWSConnection();\n    window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\n    cc.sys.localStorage.removeItem('selfPlayer');\n    //cc.director.loadScene('login');\n  },\n  updatePlayersInfo(players) {\n    if (!players) return;\n    for (let i in players) {\n      const playerInfo = players[i];\n      const playerInfoNode = this.playersInfoNode[playerInfo.joinIndex];\n      /*\n      const nameNode = playerInfoNode.getChildByName(\"name\");\n      nameNode.getComponent(cc.Label).string = constants.PLAYER_NAME[playerInfo.joinIndex];\n      */\n      playerInfoNode.active = true;\n      if (2 == playerInfo.joinIndex) {\n        this.findingAnimNode.active = false;\n      }\n    }\n\n    //显示自己的头像名称以及他人的头像名称\n    for (let i in players) {\n      const playerInfo = players[i];\n      console.log(playerInfo);\n      const playerInfoNode = this.playersInfoNode[playerInfo.joinIndex];\n\n      (() => { //远程加载头像\n        let remoteUrl = playerInfo.avatar;\n        if (remoteUrl == null || remoteUrl == '') {\n          cc.log(`No avatar to show for :`);\n          cc.log(playerInfo);\n          remoteUrl = 'http://wx.qlogo.cn/mmopen/PiajxSqBRaEJUWib5D85KXWHumaxhU4E9XOn9bUpCNKF3F4ibfOj8JYHCiaoosvoXCkTmOQE1r2AKKs8ObMaz76EdA/0'\n        }\n        cc.loader.load({\n          url: remoteUrl,\n          type: 'jpg'\n        }, function(err, texture) {\n          if (err != null) {\n            console.error(err);\n          } else {\n            const sf = new cc.SpriteFrame();\n            sf.setTexture(texture);\n            playerInfoNode.getChildByName('avatarMask').getChildByName('avatar').getComponent(cc.Sprite).spriteFrame = sf;\n          }\n        });\n      })();\n\n      function isEmptyString(str){\n        return str == null || str == ''\n      }\n\n      const nameNode = playerInfoNode.getChildByName(\"name\");\n      const nameToDisplay = (() => {\n        if(!isEmptyString(playerInfo.displayName)){\n          return playerInfo.displayName\n        }else if(!isEmptyString(playerInfo.name)){\n          return playerInfo.name\n        }else{\n          return \"No name\"\n        }\n      })();\n      nameNode.getComponent(cc.Label).string = nameToDisplay;\n    }\n  },\n});\n"]}