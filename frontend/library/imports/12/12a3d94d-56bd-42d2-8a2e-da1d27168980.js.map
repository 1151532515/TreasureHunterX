{"version":3,"sources":["../../../../assets/scripts/assets/scripts/Login.js"],"names":["i18n","require","init","window","language","cc","Class","extends","Component","properties","cavasNode","default","type","Node","backgroundNode","interactiveControls","phoneLabel","smsLoginCaptchaLabel","phoneCountryCodeInput","phoneNumberInput","phoneNumberTips","smsLoginCaptchaInput","smsLoginCaptchaButton","captchaTips","loginButton","smsWaitCountdownPrefab","Prefab","loadingPrefab","wechatLoginButton","Button","wechatLoginTips","Label","onLoad","atFirstLocationHref","location","href","split","self","getRetCodeList","getRegexList","isUsingX5BlinkKernelOrWebkitWeChatKernel","CC_DEBUG","node","active","checkPhoneNumber","bind","checkIntAuthTokenExpire","checkCaptcha","onSMSCaptchaGetButtonClicked","on","loadingNode","instantiate","smsGetCaptchaNode","getChildByName","smsWaitCountdownNode","qDict","getQueryParamDict","clearBoundRoomIdInBothVolatileAndPersistentStorage","loader","loadRes","err","textAsset","error","message","protoRoot","protobuf","Root","parse","text","RoomDownsyncFrame","lookupType","then","intAuthToken","JSON","sys","localStorage","selfPlayer","useTokenLogin","code","console","log","useWXCodeLogin","getWechatCode","retCodeDict","constants","RET_CODE","regexList","EMAIL","PHONE","STREET_META","LNG_LAT_TEXT","SEO_KEYWORD","PASSWORD","SMS_CAPTCHA_CODE","ADMIN_HANDLE","evt","timerEnable","NetworkUtils","ajax","url","backendAddress","PROTOCOL","HOST","PORT","ROUTE_PATH","API","PLAYER","VERSION","SMS_CAPTCHA","GET","data","phoneCountryCode","getComponent","EditBox","string","phoneNum","success","res","ret","OK","DUPLICATED","ALERT","TIP_LABEL","LOG_OUT","INCORRECT_PHONE_COUNTRY_CODE_OR_NUMBER","t","IS_TEST_ACC","smsLoginCaptcha","SMS_CAPTCHA_REQUESTED_TOO_FREQUENTLY","countdownTime","off","removeChild","parent","total","countdownTimer","setInterval","clearInterval","Promise","resolve","reject","Date","getTime","expiresAt","phoneNumberRegexp","phoneNumberString","test","captchaRegexp","captchaString","length","_intAuthToken","INT_AUTH_TOKEN","LOGIN","resp","onLoggedIn","xhr","status","errMsg","timeout","enableInteractiveControls","enabled","interactable","setVisible","setInvisible","onLoginButtonClicked","loginParams","onWechatLoggedIn","date","Number","playerId","displayName","stringify","expectedRoomId","history","replaceState","pathname","removeItem","WECHAT_LOGIN_FAILS","inputControls","safelyAddChild","runAction","repeatForever","rotateBy","director","loadScene","TOKEN_EXPIRED","SMS_CAPTCHA_NOT_MATCH","INCORRECT_CAPTCHA","SMS_CAPTCHA_CODE_NOT_EXISTING","INCORRECT_PHONE_NUMBER","INVALID_REQUEST_PARAM","INCORRECT_PHONE_COUNTRY_CODE","_code","WECHAT","wechatServerEndpoint","wechatAddress","trim","AUTHORIZE_PATH","APPID_LITERAL","REDIRECT_RUI_KEY","encode","RESPONSE_TYPE","SCOPE","FIN"],"mappings":"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","file":"Login.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["const i18n = require('LanguageData');\ni18n.init(window.language); // languageID should be equal to the one we input in New Language ID input field\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    cavasNode: {\n      default: null,\n      type: cc.Node\n    },\n    backgroundNode: {\n      default: null,\n      type: cc.Node\n    },\n    interactiveControls: {\n      default: null,\n      type: cc.Node\n    },\n    phoneLabel: {\n      default: null,\n      type: cc.Node\n    },\n    smsLoginCaptchaLabel: {\n      default: null,\n      type: cc.Node\n    },\n    phoneCountryCodeInput: {\n      default: null,\n      type: cc.Node\n    },\n    phoneNumberInput: {\n      type: cc.Node,\n      default: null\n    },\n    phoneNumberTips: {\n      type: cc.Node,\n      default: null\n    },\n    smsLoginCaptchaInput: {\n      type: cc.Node,\n      default: null\n    },\n    smsLoginCaptchaButton: {\n      type: cc.Node,\n      default: null\n    },\n    captchaTips: {\n      type: cc.Node,\n      default: null\n    },\n    loginButton: {\n      type: cc.Node,\n      default: null\n    },\n    smsWaitCountdownPrefab: {\n      default: null,\n      type: cc.Prefab\n    },\n    loadingPrefab: {\n      default: null,\n      type: cc.Prefab\n    },\n    wechatLoginButton: {\n      default: null,\n      type: cc.Button,\n    },\n    wechatLoginTips: {\n      default: null,\n      type: cc.Label,\n    },\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    window.atFirstLocationHref = window.location.href.split('#')[0];\n    const self = this;\n    self.getRetCodeList();\n    self.getRegexList();\n\n    const isUsingX5BlinkKernelOrWebkitWeChatKernel = window.isUsingX5BlinkKernelOrWebkitWeChatKernel();\n    if (!CC_DEBUG) {\n      self.wechatLoginButton.node.active = isUsingX5BlinkKernelOrWebkitWeChatKernel;\n\n      self.phoneNumberTips.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\n      self.smsLoginCaptchaButton.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\n\n      self.captchaTips.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\n      self.phoneCountryCodeInput.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\n      self.phoneNumberInput.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\n      self.smsLoginCaptchaInput.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\n\n      self.phoneLabel.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\n      self.smsLoginCaptchaLabel.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\n\n      self.loginButton.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\n    }\n    self.checkPhoneNumber = self.checkPhoneNumber.bind(self);\n    self.checkIntAuthTokenExpire = self.checkIntAuthTokenExpire.bind(self);\n    self.checkCaptcha = self.checkCaptcha.bind(self);\n    self.onSMSCaptchaGetButtonClicked = self.onSMSCaptchaGetButtonClicked.bind(self);\n    self.smsLoginCaptchaButton.on('click', self.onSMSCaptchaGetButtonClicked);\n\n    self.loadingNode = cc.instantiate(this.loadingPrefab);\n    self.smsGetCaptchaNode = self.smsLoginCaptchaButton.getChildByName('smsGetCaptcha');\n    self.smsWaitCountdownNode = cc.instantiate(self.smsWaitCountdownPrefab);\n\n    const qDict = window.getQueryParamDict();\n    if (null != qDict && qDict[\"expectedRoomId\"]) {\n      window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\n    }\n\n    cc.loader.loadRes(\"pbfiles/room_downsync_frame\", function(err, textAsset /* cc.TextAsset */ ) {\n      if (err) {\n        cc.error(err.message || err);\n        return;\n      }\n      let protoRoot = new protobuf.Root;\n      protobuf.parse(textAsset.text, protoRoot);\n      window.RoomDownsyncFrame = protoRoot.lookupType(\"models.RoomDownsyncFrame\");\n      self.checkIntAuthTokenExpire().then(\n        () => {\n          const intAuthToken = JSON.parse(cc.sys.localStorage.selfPlayer).intAuthToken;\n          self.useTokenLogin(intAuthToken);\n        },\n        () => {\n          window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\n          if ( (CC_DEBUG || isUsingX5BlinkKernelOrWebkitWeChatKernel) ) {\n            if (null != qDict && qDict[\"code\"]) {\n              const code = qDict[\"code\"];\n              console.log(\"Got the wx authcode: \" + code);\n              console.log(\"while at full url: \" + window.location.href);\n              self.useWXCodeLogin(code);\n            } else {\n              if (isUsingX5BlinkKernelOrWebkitWeChatKernel) {\n                self.getWechatCode(null);\n              } else {\n                // Deliberately left blank.\n              }\n            }\n          }\n        }\n      );\n    });\n  },\n\n  getRetCodeList() {\n    const self = this;\n    self.retCodeDict = constants.RET_CODE;\n  },\n\n  getRegexList() {\n    const self = this;\n    self.regexList = {\n      EMAIL: /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/,\n      PHONE: /^\\+?[0-9]{8,14}$/,\n      STREET_META: /^.{5,100}$/,\n      LNG_LAT_TEXT: /^[0-9]+(\\.[0-9]{4,6})$/,\n      SEO_KEYWORD: /^.{2,50}$/,\n      PASSWORD: /^.{6,50}$/,\n      SMS_CAPTCHA_CODE: /^[0-9]{4}$/,\n      ADMIN_HANDLE: /^.{4,50}$/,\n    };\n  },\n\n  onSMSCaptchaGetButtonClicked(evt) {\n    var timerEnable = true;\n    const self = this;\n    if (!self.checkPhoneNumber('getCaptcha')) {\n      return;\n    }\n    NetworkUtils.ajax({\n      url: backendAddress.PROTOCOL + '://' + backendAddress.HOST + ':' + backendAddress.PORT + constants.ROUTE_PATH.API + constants.ROUTE_PATH.PLAYER +\n        constants.ROUTE_PATH.VERSION + constants.ROUTE_PATH.SMS_CAPTCHA + constants.ROUTE_PATH.GET,\n      type: 'GET',\n      data: {\n        phoneCountryCode: self.phoneCountryCodeInput.getComponent(cc.EditBox).string,\n        phoneNum: self.phoneNumberInput.getComponent(cc.EditBox).string\n      },\n      success: function(res) {\n        switch (res.ret) {\n          case self.retCodeDict.OK:\n            self.phoneNumberTips.getComponent(cc.Label).string = '';\n            self.captchaTips.getComponent(cc.Label).string = '';\n            break;\n          case self.retCodeDict.DUPLICATED:\n            self.phoneNumberTips.getComponent(cc.Label).string = constants.ALERT.TIP_LABEL.LOG_OUT;\n            break;\n          case self.retCodeDict.INCORRECT_PHONE_COUNTRY_CODE_OR_NUMBER:\n            self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.PHONE_ERR\");\n            break;\n          case self.retCodeDict.IS_TEST_ACC:\n            self.smsLoginCaptchaInput.getComponent(cc.EditBox).string = res.smsLoginCaptcha;\n            self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.TEST_USER\");\n            timerEnable = false;\n            // clearInterval(self.countdownTimer);\n            break;\n          case self.retCodeDict.SMS_CAPTCHA_REQUESTED_TOO_FREQUENTLY:\n            self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.SMS_CAPTCHA_FREEQUENT_REQUIRE\");\n          default:\n            break;\n        }\n        if (timerEnable)\n          self.countdownTime(self);\n      }\n    });\n  },\n\n  countdownTime(self) {\n    self.smsLoginCaptchaButton.off('click', self.onSMSCaptchaGetButtonClicked);\n    self.smsLoginCaptchaButton.removeChild(self.smsGetCaptchaNode);\n    self.smsWaitCountdownNode.parent = self.smsLoginCaptchaButton;\n    var total = 20; // Magic number\n    self.countdownTimer = setInterval(function() {\n      if (total === 0) {\n        self.smsWaitCountdownNode.parent.removeChild(self.smsWaitCountdownNode);\n        self.smsGetCaptchaNode.parent = self.smsLoginCaptchaButton;\n        self.smsWaitCountdownNode.getChildByName('WaitTimeLabel').getComponent(cc.Label).string = 20;\n        self.smsLoginCaptchaButton.on('click', self.onSMSCaptchaGetButtonClicked);\n        clearInterval(self.countdownTimer);\n      } else {\n        total--;\n        self.smsWaitCountdownNode.getChildByName('WaitTimeLabel').getComponent(cc.Label).string = total;\n      }\n    }, 1000)\n\n  },\n\n  checkIntAuthTokenExpire() {\n    return new Promise((resolve, reject) => {\n      if (!cc.sys.localStorage.selfPlayer) {\n        reject();\n        return;\n      }\n      const selfPlayer = JSON.parse(cc.sys.localStorage.selfPlayer);\n      (selfPlayer.intAuthToken && new Date().getTime() < selfPlayer.expiresAt) ? resolve() : reject();\n    })\n  },\n\n  checkPhoneNumber(type) {\n    const self = this;\n    const phoneNumberRegexp = self.regexList.PHONE;\n    var phoneNumberString = self.phoneNumberInput.getComponent(cc.EditBox).string;\n    if (phoneNumberString) {\n      return true;\n      if (!phoneNumberRegexp.test(phoneNumberString)) {\n        self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.PHONE_ERR\");\n        return false;\n      } else {\n        return true;\n      }\n    } else {\n      if (type === 'getCaptcha' || type === 'login') {\n        self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.PHONE_ERR\");\n      }\n      return false;\n    }\n  },\n\n  checkCaptcha(type) {\n    const self = this;\n    const captchaRegexp = self.regexList.SMS_CAPTCHA_CODE;\n    var captchaString = self.smsLoginCaptchaInput.getComponent(cc.EditBox).string;\n\n    if (captchaString) {\n      if (self.smsLoginCaptchaInput.getComponent(cc.EditBox).string.length !== 4 || (!captchaRegexp.test(captchaString))) {\n        self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.CAPTCHA_ERR\");\n        return false;\n      } else {\n        return true;\n      }\n    } else {\n      if (type === 'login') {\n        self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.CAPTCHA_ERR\");\n      }\n      return false;\n    }\n  },\n\n  useTokenLogin(_intAuthToken) {\n    var self = this;\n    NetworkUtils.ajax({\n      url: backendAddress.PROTOCOL + '://' + backendAddress.HOST + ':' + backendAddress.PORT + constants.ROUTE_PATH.API + constants.ROUTE_PATH.PLAYER + constants.ROUTE_PATH.VERSION + constants.ROUTE_PATH.INT_AUTH_TOKEN + constants.ROUTE_PATH.LOGIN,\n      type: \"POST\",\n      data: {\n        intAuthToken: _intAuthToken\n      },\n      success: function(resp) {\n        self.onLoggedIn(resp);\n      },\n      error: function(xhr, status, errMsg) {\n        cc.log(`Login attempt \"useTokenLogin\" failed, about to execute \"clearBoundRoomIdInBothVolatileAndPersistentStorage\".`);\n        window.clearBoundRoomIdInBothVolatileAndPersistentStorage()\n      },\n      timeout: function() {\n        self.enableInteractiveControls(true);\n      },\n    });\n  },\n\n  enableInteractiveControls(enabled) {\n    this.smsLoginCaptchaButton.getComponent(cc.Button).interactable = enabled;\n    this.loginButton.getComponent(cc.Button).interactable = enabled;\n    this.phoneCountryCodeInput.getComponent(cc.EditBox).enabled = enabled;\n    this.phoneNumberInput.getComponent(cc.EditBox).enabled = enabled;\n    this.smsLoginCaptchaInput.getComponent(cc.EditBox).enabled = enabled;\n    if (enabled) {\n      setVisible(this.interactiveControls);\n    } else {\n      setInvisible(this.interactiveControls);\n    }\n  },\n\n  onLoginButtonClicked(evt) {\n    const self = this;\n    if (!self.checkPhoneNumber('login') || !self.checkCaptcha('login')) {\n      return;\n    }\n    self.loginParams = {\n      phoneCountryCode: self.phoneCountryCodeInput.getComponent(cc.EditBox).string,\n      phoneNum: self.phoneNumberInput.getComponent(cc.EditBox).string,\n      smsLoginCaptcha: self.smsLoginCaptchaInput.getComponent(cc.EditBox).string\n    };\n    self.enableInteractiveControls(false);\n\n    NetworkUtils.ajax({\n      url: backendAddress.PROTOCOL + '://' + backendAddress.HOST + ':' + backendAddress.PORT + constants.ROUTE_PATH.API + constants.ROUTE_PATH.PLAYER +\n        constants.ROUTE_PATH.VERSION + constants.ROUTE_PATH.SMS_CAPTCHA + constants.ROUTE_PATH.LOGIN,\n      type: \"POST\",\n      data: self.loginParams,\n      success: function(resp) {\n        self.onLoggedIn(resp);\n      },\n      error: function(xhr, status, errMsg) {\n        cc.log(`Login attempt \"onLoginButtonClicked\" failed, about to execute \"clearBoundRoomIdInBothVolatileAndPersistentStorage\".`);\n        window.clearBoundRoomIdInBothVolatileAndPersistentStorage()\n      },\n      timeout: function() {\n        self.enableInteractiveControls(true);\n      }\n    });\n  },\n  onWechatLoggedIn(res) {\n    const self = this;\n    if (res.ret === self.retCodeDict.OK) {\n      self.enableInteractiveControls(false);\n      const date = Number(res.expiresAt);\n      const selfPlayer = {\n        expiresAt: date,\n        playerId: res.playerId,\n        intAuthToken: res.intAuthToken,\n        displayName: res.displayName\n      }\n      cc.sys.localStorage.selfPlayer = JSON.stringify(selfPlayer);\n      const qDict = window.getQueryParamDict();\n      const expectedRoomId = qDict[\"expectedRoomId\"];\n      if (null != expectedRoomId) {\n        console.log(\"OnLoggedIn using expectedRoomId == \" + expectedRoomId);\n        window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\n      }\n      // To remove \"code=XXX\" in \"query string\".\n      window.history.replaceState(qDict, null, window.location.pathname);\n      self.useTokenLogin(res.intAuthToken);\n    } else {\n      cc.sys.localStorage.removeItem(\"selfPlayer\");\n      window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\n      self.wechatLoginTips.string = constants.ALERT.TIP_LABEL.WECHAT_LOGIN_FAILS + \", errorCode = \" + res.ret;\n      // To remove \"code=XXX\" in \"query string\".\n      window.history.replaceState({}, null, window.location.pathname);\n    }\n  },\n\n  onLoggedIn(res) {\n    const self = this;\n    cc.log(`OnLoggedIn ${JSON.stringify(res)}.`)\n    if (res.ret === self.retCodeDict.OK) {\n      self.enableInteractiveControls(false);\n      const date = Number(res.expiresAt);\n      const selfPlayer = {\n        expiresAt: date,\n        playerId: res.playerId,\n        intAuthToken: res.intAuthToken,\n        displayName: res.displayName\n      }\n      cc.sys.localStorage.selfPlayer = JSON.stringify(selfPlayer);\n      cc.log(`cc.sys.localStorage.selfPlayer = ${cc.sys.localStorage.selfPlayer}`);\n      if (self.countdownTimer) {\n        clearInterval(self.countdownTimer);\n      }\n      const inputControls = self.backgroundNode.getChildByName(\"InteractiveControls\");\n      self.backgroundNode.removeChild(inputControls);\n      safelyAddChild(self.backgroundNode, self.loadingNode);\n      self.loadingNode.getChildByName('loadingSprite').runAction(\n        cc.repeatForever(cc.rotateBy(1.0, 360))\n      );\n      cc.director.loadScene('default_map');\n    } else {\n      cc.sys.localStorage.removeItem(\"selfPlayer\");\n      window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\n      self.enableInteractiveControls(true);\n      switch (res.ret) {\n        case self.retCodeDict.DUPLICATED:\n          this.phoneNumberTips.getComponent(cc.Label).string = constants.ALERT.TIP_LABEL.LOG_OUT;\n          break;\n        case this.retCodeDict.TOKEN_EXPIRED:\n          this.captchaTips.getComponent(cc.Label).string = constants.ALERT.TIP_LABEL.TOKEN_EXPIRED;\n          break;\n        case this.retCodeDict.SMS_CAPTCHA_NOT_MATCH:\n          self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.SMS_CAPTCHA_NOT_MATCH\");\n          break;\n        case this.retCodeDict.INCORRECT_CAPTCHA:\n          self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.SMS_CAPTCHA_NOT_MATCH\");\n          break;\n        case this.retCodeDict.SMS_CAPTCHA_CODE_NOT_EXISTING:\n          self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.SMS_CAPTCHA_NOT_MATCH\");\n          break;\n        case this.retCodeDict.INCORRECT_PHONE_NUMBER:\n          self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.INCORRECT_PHONE_NUMBER\");\n          break;\n        case this.retCodeDict.INVALID_REQUEST_PARAM:\n          self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.INCORRECT_PHONE_NUMBER\");\n          break;\n        case this.retCodeDict.INCORRECT_PHONE_COUNTRY_CODE:\n          this.captchaTips.getComponent(cc.Label).string = constants.ALERT.TIP_LABEL.INCORRECT_PHONE_COUNTRY_CODE;\n          break;\n        default:\n          break;\n      }\n    }\n  },\n  useWXCodeLogin(_code) {\n    const self = this;\n    NetworkUtils.ajax({\n      url: backendAddress.PROTOCOL + '://' + backendAddress.HOST + ':' + backendAddress.PORT + constants.ROUTE_PATH.API + constants.ROUTE_PATH.PLAYER + constants.ROUTE_PATH.VERSION + constants.ROUTE_PATH.WECHAT + constants.ROUTE_PATH.LOGIN,\n      type: \"POST\",\n      data: {\n        code: _code\n      },\n      success: function(res) {\n        self.onWechatLoggedIn(res);\n      },\n      error: function(xhr, status, errMsg) {\n        cc.log(`Login attempt \"onLoginButtonClicked\" failed, about to execute \"clearBoundRoomIdInBothVolatileAndPersistentStorage\".`);\n        cc.sys.localStorage.removeItem(\"selfPlayer\");\n        window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\n        self.wechatLoginTips.string = constants.ALERT.TIP_LABEL.WECHAT_LOGIN_FAILS + \", errorMsg =\" + errMsg;\n        window.history.replaceState({}, null, window.location.pathname);\n      },\n    });\n  },\n  getWechatCode(evt) {\n    let self = this;\n    self.wechatLoginTips.string = \"\";\n    const wechatServerEndpoint = wechatAddress.PROTOCOL + \"://\" + wechatAddress.HOST + ((null != wechatAddress.PORT && \"\" != wechatAddress.PORT.trim()) ? (\":\" + wechatAddress.PORT) : \"\");\n    const url = wechatServerEndpoint + constants.WECHAT.AUTHORIZE_PATH + \"?\" + wechatAddress.APPID_LITERAL + \"&\" + constants.WECHAT.REDIRECT_RUI_KEY + NetworkUtils.encode(window.location.href) + \"&\" + constants.WECHAT.RESPONSE_TYPE + \"&\" + constants.WECHAT.SCOPE + constants.WECHAT.FIN;\n    console.log(\"To visit wechat auth addr: \" + url);\n    window.location.href = url;\n  },\n});\n"]}