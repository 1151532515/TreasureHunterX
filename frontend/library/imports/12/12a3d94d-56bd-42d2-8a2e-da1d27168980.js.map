{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Login.js"],"names":["i18n","require","init","window","language","cc","Class","extends","Component","properties","cavasNode","default","type","Node","backgroundNode","interactiveControls","phoneLabel","smsLoginCaptchaLabel","phoneCountryCodeInput","phoneNumberInput","phoneNumberTips","smsLoginCaptchaInput","smsLoginCaptchaButton","captchaTips","loginButton","smsWaitCountdownPrefab","Prefab","loadingPrefab","wechatLoginTips","Label","onLoad","atFirstLocationHref","location","href","split","self","getRetCodeList","getRegexList","isUsingX5BlinkKernelOrWebkitWeChatKernel","CC_DEBUG","active","checkPhoneNumber","bind","checkIntAuthTokenExpire","checkCaptcha","onSMSCaptchaGetButtonClicked","on","loadingNode","instantiate","smsGetCaptchaNode","getChildByName","smsWaitCountdownNode","qDict","getQueryParamDict","clearBoundRoomIdInBothVolatileAndPersistentStorage","loader","loadRes","err","textAsset","error","message","protoRoot","protobuf","Root","parse","text","RoomDownsyncFrame","lookupType","then","intAuthToken","JSON","sys","localStorage","selfPlayer","useTokenLogin","code","console","log","useWXCodeLogin","getWechatCode","retCodeDict","constants","RET_CODE","regexList","EMAIL","PHONE","STREET_META","LNG_LAT_TEXT","SEO_KEYWORD","PASSWORD","SMS_CAPTCHA_CODE","ADMIN_HANDLE","evt","timerEnable","NetworkUtils","ajax","url","backendAddress","PROTOCOL","HOST","PORT","ROUTE_PATH","API","PLAYER","VERSION","SMS_CAPTCHA","GET","data","phoneCountryCode","getComponent","EditBox","string","phoneNum","success","res","ret","OK","DUPLICATED","ALERT","TIP_LABEL","LOG_OUT","INCORRECT_PHONE_COUNTRY_CODE_OR_NUMBER","t","IS_TEST_ACC","smsLoginCaptcha","SMS_CAPTCHA_REQUESTED_TOO_FREQUENTLY","countdownTime","off","removeChild","parent","total","countdownTimer","setInterval","clearInterval","Promise","resolve","reject","Date","getTime","expiresAt","phoneNumberRegexp","phoneNumberString","test","captchaRegexp","captchaString","length","_intAuthToken","INT_AUTH_TOKEN","LOGIN","resp","onLoggedIn","xhr","status","errMsg","timeout","enableInteractiveControls","enabled","Button","interactable","setVisible","setInvisible","onLoginButtonClicked","loginParams","onWechatLoggedIn","date","Number","playerId","displayName","avatar","stringify","expectedRoomId","history","replaceState","pathname","removeItem","WECHAT_LOGIN_FAILS","initWxSdk","inputControls","safelyAddChild","runAction","repeatForever","rotateBy","director","loadScene","TOKEN_EXPIRED","SMS_CAPTCHA_NOT_MATCH","INCORRECT_CAPTCHA","SMS_CAPTCHA_CODE_NOT_EXISTING","INCORRECT_PHONE_NUMBER","INVALID_REQUEST_PARAM","INCORRECT_PHONE_COUNTRY_CODE","_code","WECHAT","wechatServerEndpoint","wechatAddress","trim","AUTHORIZE_PATH","APPID_LITERAL","REDIRECT_RUI_KEY","encode","RESPONSE_TYPE","SCOPE","FIN","origUrl","protocol","host","shareLink","updateAppMsgShareDataObj","dataUrl","title","document","desc","link","boundRoomId","imgUrl","menuShareTimelineObj","wxConfigUrl","isUsingWebkitWechatKernel","JSCONFIG","jsConfig","configData","debug","appId","app_id","timestamp","toString","nonceStr","nonce_str","jsApiList","signature","wx","config","ready","onMenuShareAppMessage","onMenuShareTimeline"],"mappings":"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","file":"Login.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["const i18n = require('LanguageData');\r\ni18n.init(window.language); // languageID should be equal to the one we input in New Language ID input field\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    cavasNode: {\r\n      default: null,\r\n      type: cc.Node\r\n    },\r\n    backgroundNode: {\r\n      default: null,\r\n      type: cc.Node\r\n    },\r\n    interactiveControls: {\r\n      default: null,\r\n      type: cc.Node\r\n    },\r\n    phoneLabel: {\r\n      default: null,\r\n      type: cc.Node\r\n    },\r\n    smsLoginCaptchaLabel: {\r\n      default: null,\r\n      type: cc.Node\r\n    },\r\n    phoneCountryCodeInput: {\r\n      default: null,\r\n      type: cc.Node\r\n    },\r\n    phoneNumberInput: {\r\n      type: cc.Node,\r\n      default: null\r\n    },\r\n    phoneNumberTips: {\r\n      type: cc.Node,\r\n      default: null\r\n    },\r\n    smsLoginCaptchaInput: {\r\n      type: cc.Node,\r\n      default: null\r\n    },\r\n    smsLoginCaptchaButton: {\r\n      type: cc.Node,\r\n      default: null\r\n    },\r\n    captchaTips: {\r\n      type: cc.Node,\r\n      default: null\r\n    },\r\n    loginButton: {\r\n      type: cc.Node,\r\n      default: null\r\n    },\r\n    smsWaitCountdownPrefab: {\r\n      default: null,\r\n      type: cc.Prefab\r\n    },\r\n    loadingPrefab: {\r\n      default: null,\r\n      type: cc.Prefab\r\n    },\r\n    wechatLoginTips: {\r\n      default: null,\r\n      type: cc.Label,\r\n    },\r\n  },\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n\r\n  onLoad() {\r\n    window.atFirstLocationHref = window.location.href.split('#')[0];\r\n    const self = this;\r\n    self.getRetCodeList();\r\n    self.getRegexList();\r\n\r\n    const isUsingX5BlinkKernelOrWebkitWeChatKernel = window.isUsingX5BlinkKernelOrWebkitWeChatKernel();\r\n    if (!CC_DEBUG) {\r\n      self.phoneNumberTips.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\r\n      self.smsLoginCaptchaButton.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\r\n\r\n      self.captchaTips.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\r\n      self.phoneCountryCodeInput.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\r\n      self.phoneNumberInput.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\r\n      self.smsLoginCaptchaInput.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\r\n\r\n      self.phoneLabel.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\r\n      self.smsLoginCaptchaLabel.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\r\n\r\n      self.loginButton.active = !isUsingX5BlinkKernelOrWebkitWeChatKernel;\r\n    }\r\n    self.checkPhoneNumber = self.checkPhoneNumber.bind(self);\r\n    self.checkIntAuthTokenExpire = self.checkIntAuthTokenExpire.bind(self);\r\n    self.checkCaptcha = self.checkCaptcha.bind(self);\r\n    self.onSMSCaptchaGetButtonClicked = self.onSMSCaptchaGetButtonClicked.bind(self);\r\n    self.smsLoginCaptchaButton.on('click', self.onSMSCaptchaGetButtonClicked);\r\n\r\n    self.loadingNode = cc.instantiate(this.loadingPrefab);\r\n    self.smsGetCaptchaNode = self.smsLoginCaptchaButton.getChildByName('smsGetCaptcha');\r\n    self.smsWaitCountdownNode = cc.instantiate(self.smsWaitCountdownPrefab);\r\n\r\n    const qDict = window.getQueryParamDict();\r\n    if (null != qDict && qDict[\"expectedRoomId\"]) {\r\n      window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\r\n    }\r\n\r\n    cc.loader.loadRes(\"pbfiles/room_downsync_frame\", function(err, textAsset /* cc.TextAsset */ ) {\r\n      if (err) {\r\n        cc.error(err.message || err);\r\n        return;\r\n      }\r\n      let protoRoot = new protobuf.Root;\r\n      protobuf.parse(textAsset.text, protoRoot);\r\n      window.RoomDownsyncFrame = protoRoot.lookupType(\"models.RoomDownsyncFrame\");\r\n      self.checkIntAuthTokenExpire().then(\r\n        () => {\r\n          const intAuthToken = JSON.parse(cc.sys.localStorage.selfPlayer).intAuthToken;\r\n          self.useTokenLogin(intAuthToken);\r\n        },\r\n        () => {\r\n          window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\r\n          if ( (CC_DEBUG || isUsingX5BlinkKernelOrWebkitWeChatKernel) ) {\r\n            if (null != qDict && qDict[\"code\"]) {\r\n              const code = qDict[\"code\"];\r\n              console.log(\"Got the wx authcode: \" + code);\r\n              console.log(\"while at full url: \" + window.location.href);\r\n              self.useWXCodeLogin(code);\r\n            } else {\r\n              if (isUsingX5BlinkKernelOrWebkitWeChatKernel) {\r\n                self.getWechatCode(null);\r\n              } else {\r\n                // Deliberately left blank.\r\n              }\r\n            }\r\n          }\r\n        }\r\n      );\r\n    });\r\n  },\r\n\r\n  getRetCodeList() {\r\n    const self = this;\r\n    self.retCodeDict = constants.RET_CODE;\r\n  },\r\n\r\n  getRegexList() {\r\n    const self = this;\r\n    self.regexList = {\r\n      EMAIL: /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/,\r\n      PHONE: /^\\+?[0-9]{8,14}$/,\r\n      STREET_META: /^.{5,100}$/,\r\n      LNG_LAT_TEXT: /^[0-9]+(\\.[0-9]{4,6})$/,\r\n      SEO_KEYWORD: /^.{2,50}$/,\r\n      PASSWORD: /^.{6,50}$/,\r\n      SMS_CAPTCHA_CODE: /^[0-9]{4}$/,\r\n      ADMIN_HANDLE: /^.{4,50}$/,\r\n    };\r\n  },\r\n\r\n  onSMSCaptchaGetButtonClicked(evt) {\r\n    var timerEnable = true;\r\n    const self = this;\r\n    if (!self.checkPhoneNumber('getCaptcha')) {\r\n      return;\r\n    }\r\n    NetworkUtils.ajax({\r\n      url: backendAddress.PROTOCOL + '://' + backendAddress.HOST + ':' + backendAddress.PORT + constants.ROUTE_PATH.API + constants.ROUTE_PATH.PLAYER +\r\n        constants.ROUTE_PATH.VERSION + constants.ROUTE_PATH.SMS_CAPTCHA + constants.ROUTE_PATH.GET,\r\n      type: 'GET',\r\n      data: {\r\n        phoneCountryCode: self.phoneCountryCodeInput.getComponent(cc.EditBox).string,\r\n        phoneNum: self.phoneNumberInput.getComponent(cc.EditBox).string\r\n      },\r\n      success: function(res) {\r\n        switch (res.ret) {\r\n          case self.retCodeDict.OK:\r\n            self.phoneNumberTips.getComponent(cc.Label).string = '';\r\n            self.captchaTips.getComponent(cc.Label).string = '';\r\n            break;\r\n          case self.retCodeDict.DUPLICATED:\r\n            self.phoneNumberTips.getComponent(cc.Label).string = constants.ALERT.TIP_LABEL.LOG_OUT;\r\n            break;\r\n          case self.retCodeDict.INCORRECT_PHONE_COUNTRY_CODE_OR_NUMBER:\r\n            self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.PHONE_ERR\");\r\n            break;\r\n          case self.retCodeDict.IS_TEST_ACC:\r\n            self.smsLoginCaptchaInput.getComponent(cc.EditBox).string = res.smsLoginCaptcha;\r\n            self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.TEST_USER\");\r\n            timerEnable = false;\r\n            // clearInterval(self.countdownTimer);\r\n            break;\r\n          case self.retCodeDict.SMS_CAPTCHA_REQUESTED_TOO_FREQUENTLY:\r\n            self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.SMS_CAPTCHA_FREEQUENT_REQUIRE\");\r\n          default:\r\n            break;\r\n        }\r\n        if (timerEnable)\r\n          self.countdownTime(self);\r\n      }\r\n    });\r\n  },\r\n\r\n  countdownTime(self) {\r\n    self.smsLoginCaptchaButton.off('click', self.onSMSCaptchaGetButtonClicked);\r\n    self.smsLoginCaptchaButton.removeChild(self.smsGetCaptchaNode);\r\n    self.smsWaitCountdownNode.parent = self.smsLoginCaptchaButton;\r\n    var total = 20; // Magic number\r\n    self.countdownTimer = setInterval(function() {\r\n      if (total === 0) {\r\n        self.smsWaitCountdownNode.parent.removeChild(self.smsWaitCountdownNode);\r\n        self.smsGetCaptchaNode.parent = self.smsLoginCaptchaButton;\r\n        self.smsWaitCountdownNode.getChildByName('WaitTimeLabel').getComponent(cc.Label).string = 20;\r\n        self.smsLoginCaptchaButton.on('click', self.onSMSCaptchaGetButtonClicked);\r\n        clearInterval(self.countdownTimer);\r\n      } else {\r\n        total--;\r\n        self.smsWaitCountdownNode.getChildByName('WaitTimeLabel').getComponent(cc.Label).string = total;\r\n      }\r\n    }, 1000)\r\n\r\n  },\r\n\r\n  checkIntAuthTokenExpire() {\r\n    return new Promise((resolve, reject) => {\r\n      if (!cc.sys.localStorage.selfPlayer) {\r\n        reject();\r\n        return;\r\n      }\r\n      const selfPlayer = JSON.parse(cc.sys.localStorage.selfPlayer);\r\n      (selfPlayer.intAuthToken && new Date().getTime() < selfPlayer.expiresAt) ? resolve() : reject();\r\n    })\r\n  },\r\n\r\n  checkPhoneNumber(type) {\r\n    const self = this;\r\n    const phoneNumberRegexp = self.regexList.PHONE;\r\n    var phoneNumberString = self.phoneNumberInput.getComponent(cc.EditBox).string;\r\n    if (phoneNumberString) {\r\n      return true;\r\n      if (!phoneNumberRegexp.test(phoneNumberString)) {\r\n        self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.PHONE_ERR\");\r\n        return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    } else {\r\n      if (type === 'getCaptcha' || type === 'login') {\r\n        self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.PHONE_ERR\");\r\n      }\r\n      return false;\r\n    }\r\n  },\r\n\r\n  checkCaptcha(type) {\r\n    const self = this;\r\n    const captchaRegexp = self.regexList.SMS_CAPTCHA_CODE;\r\n    var captchaString = self.smsLoginCaptchaInput.getComponent(cc.EditBox).string;\r\n\r\n    if (captchaString) {\r\n      if (self.smsLoginCaptchaInput.getComponent(cc.EditBox).string.length !== 4 || (!captchaRegexp.test(captchaString))) {\r\n        self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.CAPTCHA_ERR\");\r\n        return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    } else {\r\n      if (type === 'login') {\r\n        self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.CAPTCHA_ERR\");\r\n      }\r\n      return false;\r\n    }\r\n  },\r\n\r\n  useTokenLogin(_intAuthToken) {\r\n    var self = this;\r\n    NetworkUtils.ajax({\r\n      url: backendAddress.PROTOCOL + '://' + backendAddress.HOST + ':' + backendAddress.PORT + constants.ROUTE_PATH.API + constants.ROUTE_PATH.PLAYER + constants.ROUTE_PATH.VERSION + constants.ROUTE_PATH.INT_AUTH_TOKEN + constants.ROUTE_PATH.LOGIN,\r\n      type: \"POST\",\r\n      data: {\r\n        intAuthToken: _intAuthToken\r\n      },\r\n      success: function(resp) {\r\n        self.onLoggedIn(resp);\r\n      },\r\n      error: function(xhr, status, errMsg) {\r\n        cc.log(`Login attempt \"useTokenLogin\" failed, about to execute \"clearBoundRoomIdInBothVolatileAndPersistentStorage\".`);\r\n        window.clearBoundRoomIdInBothVolatileAndPersistentStorage()\r\n      },\r\n      timeout: function() {\r\n        self.enableInteractiveControls(true);\r\n      },\r\n    });\r\n  },\r\n\r\n  enableInteractiveControls(enabled) {\r\n    this.smsLoginCaptchaButton.getComponent(cc.Button).interactable = enabled;\r\n    this.loginButton.getComponent(cc.Button).interactable = enabled;\r\n    this.phoneCountryCodeInput.getComponent(cc.EditBox).enabled = enabled;\r\n    this.phoneNumberInput.getComponent(cc.EditBox).enabled = enabled;\r\n    this.smsLoginCaptchaInput.getComponent(cc.EditBox).enabled = enabled;\r\n    if (enabled) {\r\n      setVisible(this.interactiveControls);\r\n    } else {\r\n      setInvisible(this.interactiveControls);\r\n    }\r\n  },\r\n\r\n  onLoginButtonClicked(evt) {\r\n    const self = this;\r\n    if (!self.checkPhoneNumber('login') || !self.checkCaptcha('login')) {\r\n      return;\r\n    }\r\n    self.loginParams = {\r\n      phoneCountryCode: self.phoneCountryCodeInput.getComponent(cc.EditBox).string,\r\n      phoneNum: self.phoneNumberInput.getComponent(cc.EditBox).string,\r\n      smsLoginCaptcha: self.smsLoginCaptchaInput.getComponent(cc.EditBox).string\r\n    };\r\n    self.enableInteractiveControls(false);\r\n\r\n    NetworkUtils.ajax({\r\n      url: backendAddress.PROTOCOL + '://' + backendAddress.HOST + ':' + backendAddress.PORT + constants.ROUTE_PATH.API + constants.ROUTE_PATH.PLAYER +\r\n        constants.ROUTE_PATH.VERSION + constants.ROUTE_PATH.SMS_CAPTCHA + constants.ROUTE_PATH.LOGIN,\r\n      type: \"POST\",\r\n      data: self.loginParams,\r\n      success: function(resp) {\r\n        self.onLoggedIn(resp);\r\n      },\r\n      error: function(xhr, status, errMsg) {\r\n        cc.log(`Login attempt \"onLoginButtonClicked\" failed, about to execute \"clearBoundRoomIdInBothVolatileAndPersistentStorage\".`);\r\n        window.clearBoundRoomIdInBothVolatileAndPersistentStorage()\r\n      },\r\n      timeout: function() {\r\n        self.enableInteractiveControls(true);\r\n      }\r\n    });\r\n  },\r\n  onWechatLoggedIn(res) {\r\n    const self = this;\r\n    if (res.ret === self.retCodeDict.OK) {\r\n      self.enableInteractiveControls(false);\r\n      const date = Number(res.expiresAt);\r\n      const selfPlayer = {\r\n        expiresAt: date,\r\n        playerId: res.playerId,\r\n        intAuthToken: res.intAuthToken,\r\n        displayName: res.displayName,\r\n        avatar: res.avatar,\r\n      }\r\n      cc.sys.localStorage.selfPlayer = JSON.stringify(selfPlayer);\r\n      const qDict = window.getQueryParamDict();\r\n      const expectedRoomId = qDict[\"expectedRoomId\"];\r\n      if (null != expectedRoomId) {\r\n        console.log(\"OnLoggedIn using expectedRoomId == \" + expectedRoomId);\r\n        window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\r\n      }\r\n      // To remove \"code=XXX\" in \"query string\".\r\n      window.history.replaceState(qDict, null, window.location.pathname);\r\n      self.useTokenLogin(res.intAuthToken);\r\n    } else {\r\n      cc.sys.localStorage.removeItem(\"selfPlayer\");\r\n      window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\r\n      self.wechatLoginTips.string = constants.ALERT.TIP_LABEL.WECHAT_LOGIN_FAILS + \", errorCode = \" + res.ret;\r\n      // To remove \"code=XXX\" in \"query string\".\r\n      window.history.replaceState({}, null, window.location.pathname);\r\n    }\r\n  },\r\n\r\n  onLoggedIn(res) {\r\n    const self = this;\r\n    cc.log(`OnLoggedIn ${JSON.stringify(res)}.`)\r\n    if (res.ret === self.retCodeDict.OK) {\r\n      if(window.isUsingX5BlinkKernelOrWebkitWeChatKernel()) {\r\n        window.initWxSdk = self.initWxSdk.bind(self);\r\n        window.initWxSdk();\r\n      }\r\n      self.enableInteractiveControls(false);\r\n      const date = Number(res.expiresAt);\r\n      const selfPlayer = {\r\n        expiresAt: date,\r\n        playerId: res.playerId,\r\n        intAuthToken: res.intAuthToken,\r\n        avatar: res.avatar,\r\n        displayName: res.displayName,\r\n      }\r\n      cc.sys.localStorage.selfPlayer = JSON.stringify(selfPlayer);\r\n      cc.log(`cc.sys.localStorage.selfPlayer = ${cc.sys.localStorage.selfPlayer}`);\r\n      if (self.countdownTimer) {\r\n        clearInterval(self.countdownTimer);\r\n      }\r\n      const inputControls = self.backgroundNode.getChildByName(\"InteractiveControls\");\r\n      self.backgroundNode.removeChild(inputControls);\r\n      safelyAddChild(self.backgroundNode, self.loadingNode);\r\n      self.loadingNode.getChildByName('loadingSprite').runAction(\r\n        cc.repeatForever(cc.rotateBy(1.0, 360))\r\n      );\r\n      cc.director.loadScene('default_map');\r\n    } else {\r\n      cc.sys.localStorage.removeItem(\"selfPlayer\");\r\n      window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\r\n      self.enableInteractiveControls(true);\r\n      switch (res.ret) {\r\n        case self.retCodeDict.DUPLICATED:\r\n          this.phoneNumberTips.getComponent(cc.Label).string = constants.ALERT.TIP_LABEL.LOG_OUT;\r\n          break;\r\n        case this.retCodeDict.TOKEN_EXPIRED:\r\n          this.captchaTips.getComponent(cc.Label).string = constants.ALERT.TIP_LABEL.TOKEN_EXPIRED;\r\n          break;\r\n        case this.retCodeDict.SMS_CAPTCHA_NOT_MATCH:\r\n          self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.SMS_CAPTCHA_NOT_MATCH\");\r\n          break;\r\n        case this.retCodeDict.INCORRECT_CAPTCHA:\r\n          self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.SMS_CAPTCHA_NOT_MATCH\");\r\n          break;\r\n        case this.retCodeDict.SMS_CAPTCHA_CODE_NOT_EXISTING:\r\n          self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.SMS_CAPTCHA_NOT_MATCH\");\r\n          break;\r\n        case this.retCodeDict.INCORRECT_PHONE_NUMBER:\r\n          self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.INCORRECT_PHONE_NUMBER\");\r\n          break;\r\n        case this.retCodeDict.INVALID_REQUEST_PARAM:\r\n          self.captchaTips.getComponent(cc.Label).string = i18n.t(\"login.tips.INCORRECT_PHONE_NUMBER\");\r\n          break;\r\n        case this.retCodeDict.INCORRECT_PHONE_COUNTRY_CODE:\r\n          this.captchaTips.getComponent(cc.Label).string = constants.ALERT.TIP_LABEL.INCORRECT_PHONE_COUNTRY_CODE;\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n  },\r\n  useWXCodeLogin(_code) {\r\n    const self = this;\r\n    NetworkUtils.ajax({\r\n      url: backendAddress.PROTOCOL + '://' + backendAddress.HOST + ':' + backendAddress.PORT + constants.ROUTE_PATH.API + constants.ROUTE_PATH.PLAYER + constants.ROUTE_PATH.VERSION + constants.ROUTE_PATH.WECHAT + constants.ROUTE_PATH.LOGIN,\r\n      type: \"POST\",\r\n      data: {\r\n        code: _code\r\n      },\r\n      success: function(res) {\r\n        self.onWechatLoggedIn(res);\r\n      },\r\n      error: function(xhr, status, errMsg) {\r\n        cc.log(`Login attempt \"onLoginButtonClicked\" failed, about to execute \"clearBoundRoomIdInBothVolatileAndPersistentStorage\".`);\r\n        cc.sys.localStorage.removeItem(\"selfPlayer\");\r\n        window.clearBoundRoomIdInBothVolatileAndPersistentStorage();\r\n        self.wechatLoginTips.string = constants.ALERT.TIP_LABEL.WECHAT_LOGIN_FAILS + \", errorMsg =\" + errMsg;\r\n        window.history.replaceState({}, null, window.location.pathname);\r\n      },\r\n    });\r\n  },\r\n  getWechatCode(evt) {\r\n    let self = this;\r\n    self.wechatLoginTips.string = \"\";\r\n    const wechatServerEndpoint = wechatAddress.PROTOCOL + \"://\" + wechatAddress.HOST + ((null != wechatAddress.PORT && \"\" != wechatAddress.PORT.trim()) ? (\":\" + wechatAddress.PORT) : \"\");\r\n    const url = wechatServerEndpoint + constants.WECHAT.AUTHORIZE_PATH + \"?\" + wechatAddress.APPID_LITERAL + \"&\" + constants.WECHAT.REDIRECT_RUI_KEY + NetworkUtils.encode(window.location.href) + \"&\" + constants.WECHAT.RESPONSE_TYPE + \"&\" + constants.WECHAT.SCOPE + constants.WECHAT.FIN;\r\n    console.log(\"To visit wechat auth addr: \" + url);\r\n    window.location.href = url;\r\n  },\r\n\r\n  initWxSdk() {\r\n    const selfPlayer = JSON.parse(cc.sys.localStorage.selfPlayer);\r\n    const origUrl = window.location.protocol + \"//\" + window.location.host + window.location.pathname;\r\n    /*\r\n    * The `shareLink` must \r\n    * - have its 2nd-order-domain registered as trusted 2nd-order under the targetd `res.jsConfig.app_id`, and\r\n    * - extracted from current window.location.href.   \r\n    */\r\n    const shareLink = origUrl;\r\n    const updateAppMsgShareDataObj = {\r\n      type: 'link', // 分享类型,music、video或link，不填默认为link\r\n      dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空\r\n      title: document.title, // 分享标题\r\n      desc: 'Let\\'s play together!', // 分享描述\r\n      link: shareLink + (null == cc.sys.localStorage.boundRoomId ? \"\" : (\"?expectedRoomId=\" + cc.sys.localStorage.boundRoomId)),\r\n      imgUrl: origUrl + \"/favicon.ico\", // 分享图标\r\n      success: function() {\r\n        // 设置成功\r\n      }\r\n    };\r\n    const menuShareTimelineObj = {\r\n      title: document.title, // 分享标题\r\n      link: shareLink + (null == cc.sys.localStorage.boundRoomId ? \"\" : (\"?expectedRoomId=\" + cc.sys.localStorage.boundRoomId)),\r\n      imgUrl: origUrl + \"/favicon.ico\", // 分享图标\r\n      success: function() {}\r\n    };\r\n\r\n    const wxConfigUrl = (window.isUsingWebkitWechatKernel() ? window.atFirstLocationHref : window.location.href); \r\n    //接入微信登录接口\r\n    NetworkUtils.ajax({\r\n      \"url\": backendAddress.PROTOCOL + '://' + backendAddress.HOST + ':' + backendAddress.PORT + constants.ROUTE_PATH.API + constants.ROUTE_PATH.PLAYER + constants.ROUTE_PATH.VERSION + constants.ROUTE_PATH.WECHAT + constants.ROUTE_PATH.JSCONFIG,\r\n      type: \"POST\",\r\n      data: {\r\n        \"url\": wxConfigUrl,\r\n        \"intAuthToken\": selfPlayer.intAuthToken,\r\n      },\r\n      success: function(res) {\r\n        if (constants.RET_CODE.OK != res.ret) {\r\n          console.log(\"cannot get the wsConfig. retCode == \" + res.ret);\r\n          return;\r\n        }\r\n        const jsConfig = res.jsConfig;\r\n        console.log(updateAppMsgShareDataObj);\r\n        const configData = {\r\n          debug: CC_DEBUG, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。\r\n          appId: jsConfig.app_id, // 必填，公众号的唯一标识\r\n          timestamp: jsConfig.timestamp.toString(), // 必填，生成签名的时间戳\r\n          nonceStr: jsConfig.nonce_str, // 必填，生成签名的随机串\r\n          jsApiList: ['onMenuShareAppMessage', 'onMenuShareTimeline'],\r\n          signature: jsConfig.signature, // 必填，签名\r\n        };\r\n        console.log(\"config url: \" + wxConfigUrl);\r\n        console.log(\"wx.config: \");\r\n        console.log(configData);\r\n        wx.config(configData);\r\n        console.log(\"Current window.location.href: \" + window.location.href);\r\n        wx.ready(function() {\r\n          console.log(\"Here is wx.ready.\")\r\n          wx.onMenuShareAppMessage(updateAppMsgShareDataObj);\r\n          wx.onMenuShareTimeline(menuShareTimelineObj);\r\n        });\r\n        wx.error(function(res) {\r\n          console.error(\"wx config fails and error is \" + JSON.stringify(res));\r\n        });\r\n      },\r\n      error: function(xhr, status, errMsg) {\r\n        console.log(\"cannot get the wsConfig. errMsg == \" + errMsg);\r\n      },\r\n    });\r\n  },\r\n});\r\n"]}