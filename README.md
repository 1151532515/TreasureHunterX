# 1. Database Server

The database product to be used for this project is MySQL 5.7.

We use [skeema](https://github.com/skeema/skeema) for schematic synchronization under `<proj-root>/database/skeema-repo-root/` which intentionally doesn't contain a `.skeema` file. Please read [this tutorial](https://shimo.im/doc/wQ0LvB0rlZcbHF5V) for more information.

You can use [this node module (still under development)](https://github.com/genxium/node-mysqldiff-bridge) instead under `Windows10`, other versions of Windows are not yet tested for compatibility.

The following command(s)
```
### Optional.
user@proj-root/database/skeema-repo-root> cp .skeema.template .skeema

###
user@proj-root/database/skeema-repo-root> skeema diff
```
is recommended to be used for checking difference from your "live MySQL server" to the latest expected schema tracked in git.

# 2. Building & running

## 2.1 Golang1.11
See https://github.com/genxium/Go111ModulePrac for details.

## 2.2 MySQL 
On a product machine, you can install and manage `MySQL` server by [these scripts](https://github.com/genxium/Ubuntu14InitScripts/tree/master/database/mysql).

## 2.3 Required Config Files

### 2.3.1 Backend 
- It needs `<proj-root>/battle_srv/configs/*` which is generated by `cd <proj-root>/battle_srv && cp -r ./configs.template ./configs` and necessary customization.

### 2.3.2 Frontend 
- It needs `<proj-root>/frontend/assets/plugin_scripts/conf.js` which is generated by `cd <proj-root>/frontend/assets/plugin_scripts && cp conf.js.template conf.js`.

## 2.4 Different "ServerEnv"s for the runtime of backend service 

本游戏具备账号系统且主要注册方式为"Phonenum+SMSCaptcha"，考虑到开发者和公司内部测试的需要，服务器将提供以下的"ServerEnv"s供在runtime of backend service按需采用。

### 2.4.1 ServerEnv == PROD (如不指定ServerEnv则默认为PROD)
```
user@proj-root/battle_srv> make run-prod
```

将不允许使用“测试账号”。

### 2.4.2 ServerEnv == TEST
```
user@proj-root/battle_srv> make run-test
```

将允许使用“测试账号”，详见 https://shimo.im/docs/Q7wqNHlvyYQu0nYP 说明。


## 2.5 Troubleshooting

### 2.5.1 Redis snapshot writing failure
```
ErrFatal        {"err": "MISCONF Redis is configured to save RDB snapshots, but is currently not able to persist on disk. Commands that may modify the data set are disabled. Please check Redis logs for details about the error."}
```

Just restart your `redis-server` process.
