{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\SelfPlayer.js"],"names":["BasePlayer","require","cc","Class","extends","start","prototype","call","onLoad","clips","_canMoveBy","vecToMoveBy","superRet","self","computedNewDifferentPosLocalToParentWithinCurrentFrame","node","position","add","currentSelfColliderCircle","getComponent","CircleCollider","nextSelfColliderCircle","contactedBarriers","length","contactedNPCPlayers","contactedControlledPlayers","mutatedVecToMoveBy","mul","offset","radius","aCircleCollider","contactedCircleLocalToParentWithinCurrentFrame","Intersection","circleCircle","update","dt"],"mappings":";;;;;;AAAA,IAAMA,aAAaC,QAAQ,cAAR,CAAnB;;AAEAC,GAAGC,KAAH,CAAS;AACPC,WAASJ,UADF;;AAGP;AACAK,OAJO,mBAIC;AACNL,eAAWM,SAAX,CAAqBD,KAArB,CAA2BE,IAA3B,CAAgC,IAAhC;AACD,GANM;AAQPC,QARO,oBAQE;AACPR,eAAWM,SAAX,CAAqBE,MAArB,CAA4BD,IAA5B,CAAiC,IAAjC;AACA,SAAKE,KAAL,GAAa;AACX,YAAM,sBADK;AAEX,aAAO,yBAFI;AAGX,aAAO,uBAHI;AAIX,YAAM,wBAJK;AAKX,aAAO,0BALI;AAMX,YAAM,2BANK;AAOX,cAAQ,6BAPG;AAQX,aAAO;AARI,KAAb;AAUD,GApBM;AAsBPC,YAtBO,sBAsBIC,WAtBJ,EAsBiB;AACtB,QAAMC,WAAWZ,WAAWM,SAAX,CAAqBI,UAArB,CAAgCH,IAAhC,CAAqC,IAArC,EAA2CI,WAA3C,CAAjB;AACA,QAAME,OAAO,IAAb;;AAEA,QAAMC,yDAAyDD,KAAKE,IAAL,CAAUC,QAAV,CAAmBC,GAAnB,CAAuBN,WAAvB,CAA/D;;AAEA,QAAMO,4BAA4BL,KAAKE,IAAL,CAAUI,YAAV,CAAuBjB,GAAGkB,cAA1B,CAAlC;AACA,QAAIC,yBAAyB,IAA7B;AACA,QAAI,IAAIR,KAAKS,iBAAL,CAAuBC,MAA3B,IAAqC,IAAIV,KAAKW,mBAAL,CAAyBD,MAAlE,IAA4E,IAAIV,KAAKY,0BAAzF,EAAqH;AACnH;AACA,UAAMC,qBAAqBf,YAAYgB,GAAZ,CAAgB,CAAhB,CAA3B;AACAN,+BAAyB;AACvBL,kBAAUH,KAAKE,IAAL,CAAUC,QAAV,CAAmBC,GAAnB,CAAuBN,YAAYgB,GAAZ,CAAgB,CAAhB,CAAvB,EAA2CV,GAA3C,CAA+CC,0BAA0BU,MAAzE,CADa;AAEvBC,gBAAQX,0BAA0BW;AAFX,OAAzB;AAID,KAPD,MAOO;AACLR,+BAAyB;AACvBL,kBAAUF,uDAAuDG,GAAvD,CAA2DC,0BAA0BU,MAArF,CADa;AAEvBC,gBAAQX,0BAA0BW;AAFX,OAAzB;AAID;;AApBqB;AAAA;AAAA;;AAAA;AAsBtB,2BAA4BhB,KAAKW,mBAAjC,8HAAsD;AAAA,YAA7CM,eAA6C;;AACpD,YAAIC,iDAAiD;AACnDf,oBAAUc,gBAAgBf,IAAhB,CAAqBC,QAArB,CAA8BC,GAA9B,CAAkCa,gBAAgBF,MAAlD,CADyC;AAEnDC,kBAAQC,gBAAgBD;AAF2B,SAArD;AAIA,YAAI3B,GAAG8B,YAAH,CAAgBC,YAAhB,CAA6BF,8CAA7B,EAA6EV,sBAA7E,CAAJ,EAA0G;AACxG,iBAAO,KAAP;AACD;AACF;AA9BqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAgCtB,WAAOT,QAAP;AACD,GAvDM;AAyDPsB,QAzDO,kBAyDAC,EAzDA,EAyDI;AACTnC,eAAWM,SAAX,CAAqB4B,MAArB,CAA4B3B,IAA5B,CAAiC,IAAjC,EAAuC4B,EAAvC;AACA;;;;AAID;AA/DM,CAAT","file":"SelfPlayer.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["const BasePlayer = require(\"./BasePlayer\"); \n\ncc.Class({\n  extends: BasePlayer,\n\n  // LIFE-CYCLE CALLBACKS:\n  start() {\n    BasePlayer.prototype.start.call(this);\n  },\n\n  onLoad() {\n    BasePlayer.prototype.onLoad.call(this);\n    this.clips = {\n      '01': 'FlatHeadSisterRunTop',\n      '0-1': 'FlatHeadSisterRunBottom',\n      '-20': 'FlatHeadSisterRunLeft',\n      '20': 'FlatHeadSisterRunRight',\n      '-21': 'FlatHeadSisterRunTopLeft',\n      '21': 'FlatHeadSisterRunTopRight',\n      '-2-1': 'FlatHeadSisterRunBottomLeft',\n      '2-1': 'FlatHeadSisterRunBottomRight'\n    };\n  },\n\n  _canMoveBy(vecToMoveBy) {\n    const superRet = BasePlayer.prototype._canMoveBy.call(this, vecToMoveBy);\n    const self = this;\n\n    const computedNewDifferentPosLocalToParentWithinCurrentFrame = self.node.position.add(vecToMoveBy);\n\n    const currentSelfColliderCircle = self.node.getComponent(cc.CircleCollider); \n    let nextSelfColliderCircle = null;\n    if (0 < self.contactedBarriers.length || 0 < self.contactedNPCPlayers.length || 0 < self.contactedControlledPlayers) {\n      /* To avoid unexpected buckling. */\n      const mutatedVecToMoveBy = vecToMoveBy.mul(2);\n      nextSelfColliderCircle = {\n        position: self.node.position.add(vecToMoveBy.mul(2)).add(currentSelfColliderCircle.offset),  \n        radius: currentSelfColliderCircle.radius,\n      };\n    } else {\n      nextSelfColliderCircle = {\n        position: computedNewDifferentPosLocalToParentWithinCurrentFrame.add(currentSelfColliderCircle.offset),  \n        radius: currentSelfColliderCircle.radius,\n      };\n    }\n\n    for (let aCircleCollider of self.contactedNPCPlayers) {\n      let contactedCircleLocalToParentWithinCurrentFrame = {\n        position: aCircleCollider.node.position.add(aCircleCollider.offset),  \n        radius: aCircleCollider.radius,\n      };\n      if (cc.Intersection.circleCircle(contactedCircleLocalToParentWithinCurrentFrame, nextSelfColliderCircle)) {\n        return false;\n      }\n    }\n\n    return superRet;\n  },\n\n  update(dt) {\n    BasePlayer.prototype.update.call(this, dt);\n    /*\n    const labelNode = this.node.getChildByName(\"CoordinateLabel\");\n    labelNode.getComponent(\"cc.Label\").string = \"M_(\" + this.node.x.toFixed(2) + \", \" + this.node.y.toFixed(2) + \")\";\n    */\n  },\n\n});\n"]}